{"version":3,"file":"research-tools-DGotpYen.js","sources":["../../src/research/legacy-ich-model.js","../../src/research/data-logger.js","../../src/research/comparison-ui.js","../../src/analytics/clinical-reporting.js","../../src/analytics/quality-metrics.js","../../src/analytics/audit-trail.js"],"sourcesContent":["/**\r\n * Legacy ICH Model - Simple Logistic Regression (Age + GFAP Only)\r\n *\r\n * This is a baseline model for research comparison purposes.\r\n * Uses only age and GFAP values with logistic regression.\r\n *\r\n * Performance Metrics:\r\n * - ROC-AUC: 0.789\r\n * - Recall: 40%\r\n * - Precision: 86%\r\n * - F1-Score: 55%\r\n *\r\n * FOR RESEARCH COMPARISON ONLY - NOT FOR CLINICAL USE\r\n */\r\n\r\nexport class LegacyICHModel {\r\n  // Training data parameters from original study\r\n  static PARAMS = {\r\n    age: {\r\n      mean: 74.59,\r\n      std: 12.75,\r\n    },\r\n    gfap: {\r\n      mean: 665.23,\r\n      std: 2203.77,\r\n    },\r\n    coefficients: {\r\n      intercept: 0.3248,\r\n      age: -0.2108, // Negative: older age slightly decreases odds in this simple model\r\n      gfap: 3.1631, // Positive: higher GFAP significantly increases odds\r\n    },\r\n  };\r\n\r\n  /**\r\n   * Calculate ICH probability using legacy logistic regression model\r\n   * @param {number} age - Patient age in years\r\n   * @param {number} gfapValue - GFAP value in pg/ml\r\n   * @returns {object} - Probability and diagnostic information\r\n   */\r\n  static calculateProbability(age, gfapValue) {\r\n    // Input validation\r\n    if (!age || !gfapValue || age <= 0 || gfapValue <= 0) {\r\n      return {\r\n        probability: 0,\r\n        confidence: 0,\r\n        isValid: false,\r\n        reason: 'Invalid inputs: age and GFAP required',\r\n      };\r\n    }\r\n\r\n    // Validate ranges\r\n    if (age < 18 || age > 120) {\r\n      return {\r\n        probability: 0,\r\n        confidence: 0,\r\n        isValid: false,\r\n        reason: `Age ${age} outside valid range (18-120 years)`,\r\n      };\r\n    }\r\n\r\n    if (gfapValue < 10 || gfapValue > 20000) {\r\n      // (`GFAP ${gfapValue} outside typical range (10-20000 pg/ml)`);\r\n    }\r\n\r\n    try {\r\n      // Step 1: Scale inputs using training data statistics\r\n      const scaledAge = (age - this.PARAMS.age.mean) / this.PARAMS.age.std;\r\n      const scaledGfap = (gfapValue - this.PARAMS.gfap.mean) / this.PARAMS.gfap.std;\r\n\r\n      // Step 2: Calculate log-odds (logit)\r\n      const logit = this.PARAMS.coefficients.intercept\r\n                    + (this.PARAMS.coefficients.age * scaledAge)\r\n                    + (this.PARAMS.coefficients.gfap * scaledGfap);\r\n\r\n      // Step 3: Convert to probability using sigmoid function\r\n      const rawProbability = 1 / (1 + Math.exp(-logit));\r\n      const probability = rawProbability * 100; // Convert to percentage\r\n\r\n      // Step 4: Calculate confidence based on distance from decision boundary\r\n      // Confidence is higher when probability is closer to 0% or 100%\r\n      const confidence = Math.abs(rawProbability - 0.5) * 2; // 0 to 1 scale\r\n\r\n      // Step 5: Determine risk category\r\n      const riskCategory = this.getRiskCategory(probability);\r\n\r\n      return {\r\n        probability: Math.round(probability * 10) / 10, // Round to 1 decimal\r\n        confidence: Math.round(confidence * 100) / 100, // Round to 2 decimals\r\n        logit: Math.round(logit * 1000) / 1000, // Round to 3 decimals\r\n        riskCategory,\r\n        scaledInputs: {\r\n          age: Math.round(scaledAge * 1000) / 1000,\r\n          gfap: Math.round(scaledGfap * 1000) / 1000,\r\n        },\r\n        rawInputs: { age, gfap: gfapValue },\r\n        isValid: true,\r\n        calculationMethod: 'logistic_regression_age_gfap',\r\n      };\r\n    } catch (error) {\r\n      // ('Legacy model calculation error:', error);\r\n      return {\r\n        probability: 0,\r\n        confidence: 0,\r\n        isValid: false,\r\n        reason: 'Calculation error',\r\n        error: error.message,\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get risk category and color based on probability\r\n   * @param {number} probability - Probability percentage (0-100)\r\n   * @returns {object} - Risk level information\r\n   */\r\n  static getRiskCategory(probability) {\r\n    if (probability < 10) {\r\n      return {\r\n        level: 'very_low',\r\n        color: '#10b981',\r\n        label: 'Very Low Risk',\r\n        description: 'Minimal ICH likelihood',\r\n      };\r\n    }\r\n    if (probability < 25) {\r\n      return {\r\n        level: 'low',\r\n        color: '#84cc16',\r\n        label: 'Low Risk',\r\n        description: 'Below typical threshold',\r\n      };\r\n    }\r\n    if (probability < 50) {\r\n      return {\r\n        level: 'moderate',\r\n        color: '#f59e0b',\r\n        label: 'Moderate Risk',\r\n        description: 'Elevated concern',\r\n      };\r\n    }\r\n    if (probability < 75) {\r\n      return {\r\n        level: 'high',\r\n        color: '#f97316',\r\n        label: 'High Risk',\r\n        description: 'Significant likelihood',\r\n      };\r\n    }\r\n    return {\r\n      level: 'very_high',\r\n      color: '#dc2626',\r\n      label: 'Very High Risk',\r\n      description: 'Critical ICH probability',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Compare legacy model with main model results\r\n   * @param {object} mainResults - Results from complex ML model\r\n   * @param {object} legacyResults - Results from legacy model\r\n   * @returns {object} - Comparison analysis\r\n   */\r\n  static compareModels(mainResults, legacyResults) {\r\n    if (!mainResults || !legacyResults || !legacyResults.isValid) {\r\n      return {\r\n        isValid: false,\r\n        reason: 'Invalid model results for comparison',\r\n      };\r\n    }\r\n\r\n    // Normalize probabilities to percentage scale (0-100)\r\n    let mainProb = mainResults.probability || 0;\r\n    if (mainProb <= 1) {\r\n      mainProb *= 100; // Convert 0.65 to 65%\r\n    }\r\n\r\n    const legacyProb = legacyResults.probability || 0; // Already in percentage\r\n\r\n    const absoluteDifference = mainProb - legacyProb;\r\n    const relativeDifference = legacyProb > 0 ? (absoluteDifference / legacyProb) * 100 : 0;\r\n\r\n    // Determine which model suggests higher risk\r\n    const higherRiskModel = mainProb > legacyProb ? 'main'\r\n      : legacyProb > mainProb ? 'legacy' : 'equal';\r\n\r\n    // Assess agreement level\r\n    let agreement;\r\n    const absDiff = Math.abs(absoluteDifference);\r\n    if (absDiff < 5) {\r\n      agreement = 'strong';\r\n    } else if (absDiff < 15) {\r\n      agreement = 'moderate';\r\n    } else if (absDiff < 30) {\r\n      agreement = 'weak';\r\n    } else {\r\n      agreement = 'poor';\r\n    }\r\n\r\n    return {\r\n      isValid: true,\r\n      probabilities: {\r\n        main: Math.round(mainProb * 10) / 10,\r\n        legacy: Math.round(legacyProb * 10) / 10,\r\n      },\r\n      differences: {\r\n        absolute: Math.round(absoluteDifference * 10) / 10,\r\n        relative: Math.round(relativeDifference * 10) / 10,\r\n      },\r\n      agreement: {\r\n        level: agreement,\r\n        higherRiskModel,\r\n      },\r\n      interpretation: this.getComparisonInterpretation(absoluteDifference, agreement),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get interpretation of model comparison\r\n   * @param {number} difference - Absolute difference between models\r\n   * @param {string} agreement - Agreement level\r\n   * @returns {object} - Interpretation for researchers\r\n   */\r\n  static getComparisonInterpretation(difference, agreement) {\r\n    const absDiff = Math.abs(difference);\r\n\r\n    if (agreement === 'strong') {\r\n      return {\r\n        type: 'concordant',\r\n        message: 'Models show strong agreement',\r\n        implication: 'Age and GFAP are primary risk factors',\r\n      };\r\n    }\r\n\r\n    if (absDiff > 20) {\r\n      return {\r\n        type: 'divergent',\r\n        message: 'Significant model disagreement',\r\n        implication: 'Complex model captures additional risk factors not in age/GFAP',\r\n      };\r\n    }\r\n\r\n    return {\r\n      type: 'moderate_difference',\r\n      message: 'Models show moderate difference',\r\n      implication: 'Additional factors provide incremental predictive value',\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Test the legacy model with known cases\r\n   * @returns {object} - Test results for validation\r\n   */\r\n  static runValidationTests() {\r\n    const testCases = [\r\n      {\r\n        age: 65, gfap: 100, expected: 'low', description: 'Younger patient, low GFAP',\r\n      },\r\n      {\r\n        age: 75, gfap: 500, expected: 'moderate', description: 'Average age, moderate GFAP',\r\n      },\r\n      {\r\n        age: 85, gfap: 1000, expected: 'high', description: 'Older patient, high GFAP',\r\n      },\r\n      {\r\n        age: 70, gfap: 2000, expected: 'very_high', description: 'High GFAP dominates',\r\n      },\r\n      {\r\n        age: 90, gfap: 50, expected: 'very_low', description: 'Low GFAP despite age',\r\n      },\r\n    ];\r\n\r\n    const results = testCases.map((testCase) => {\r\n      const result = this.calculateProbability(testCase.age, testCase.gfap);\r\n      return {\r\n        ...testCase,\r\n        result,\r\n        passed: result.isValid && result.riskCategory.level === testCase.expected,\r\n      };\r\n    });\r\n\r\n    const passedTests = results.filter((r) => r.passed).length;\r\n    const totalTests = results.length;\r\n\r\n    return {\r\n      summary: {\r\n        passed: passedTests,\r\n        total: totalTests,\r\n        passRate: Math.round((passedTests / totalTests) * 100),\r\n      },\r\n      details: results,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get model metadata for research documentation\r\n   * @returns {object} - Model information\r\n   */\r\n  static getModelMetadata() {\r\n    return {\r\n      name: 'Legacy ICH Model',\r\n      type: 'Logistic Regression',\r\n      version: '1.0.0',\r\n      features: ['age', 'gfap'],\r\n      performance: {\r\n        rocAuc: 0.789,\r\n        recall: 0.40,\r\n        precision: 0.86,\r\n        f1Score: 0.55,\r\n        specificity: 0.94,\r\n      },\r\n      trainingData: {\r\n        samples: 'Historical cohort',\r\n        dateRange: 'Research study period',\r\n        validation: 'Cross-validation',\r\n      },\r\n      limitations: [\r\n        'Only uses age and GFAP - ignores clinical symptoms',\r\n        'Lower recall (40%) - misses some ICH cases',\r\n        'No time-to-onset consideration',\r\n        'No blood pressure or medication factors',\r\n        'Simplified feature set for baseline comparison',\r\n      ],\r\n      purpose: 'Research baseline for evaluating complex model improvements',\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Utility function to safely calculate legacy model in existing app flow\r\n * @param {object} patientData - Existing patient data structure\r\n * @returns {object|null} - Legacy model results or null if not applicable\r\n */\r\nexport function calculateLegacyICH(patientData) {\r\n  try {\r\n    // Extract age and GFAP from various possible data structures\r\n    const age = patientData?.age_years || patientData?.age || null;\r\n    const gfap = patientData?.gfap_value || patientData?.gfap || null;\r\n\r\n    if (!age || !gfap) {\r\n      return null; // Silently fail if required data not available\r\n    }\r\n\r\n    return LegacyICHModel.calculateProbability(age, gfap);\r\n  } catch (error) {\r\n    // ('Legacy ICH calculation failed (non-critical):', error);\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Export test function for validation\r\n */\r\nexport function testLegacyModel() {\r\n  // ('🧪 Legacy ICH Model Validation Tests');\r\n  const testResults = LegacyICHModel.runValidationTests();\r\n\r\n  // (`✅ Passed: ${testResults.summary.passed}/${testResults.summary.total} tests`);\r\n  // (`📊 Pass Rate: ${testResults.summary.passRate}%`);\r\n\r\n  testResults.details.forEach((test) => {\r\n    const icon = test.passed ? '✅' : '❌';\r\n    // (`${icon} ${test.description}: ${test.result.probability.toFixed(1)}% (${test.result.riskCategory.level})`);\r\n  });\r\n\r\n  return testResults;\r\n}\r\n","/**\r\n * Research Data Logger\r\n * Safely stores model comparison data for research analysis\r\n * All data stays local - no external transmission\r\n */\r\n\r\nimport { LegacyICHModel } from './legacy-ich-model.js';\r\n\r\nexport class ResearchDataLogger {\r\n  static STORAGE_KEY = 'igfap_research_data';\r\n\r\n  static MAX_ENTRIES = 1000; // Prevent unlimited storage growth\r\n\r\n  /**\r\n   * Log comparison between main and legacy models\r\n   * @param {object} comparisonData - Data from both models\r\n   */\r\n  static logComparison(comparisonData) {\r\n    try {\r\n      const entry = {\r\n        id: this.generateEntryId(),\r\n        timestamp: new Date().toISOString(),\r\n        sessionId: this.getSessionId(),\r\n        ...comparisonData,\r\n      };\r\n\r\n      const stored = this.getStoredData();\r\n      stored.entries.push(entry);\r\n\r\n      // Limit storage size\r\n      if (stored.entries.length > this.MAX_ENTRIES) {\r\n        stored.entries = stored.entries.slice(-this.MAX_ENTRIES);\r\n      }\r\n\r\n      stored.lastUpdated = new Date().toISOString();\r\n      stored.totalComparisons = stored.entries.length;\r\n\r\n      localStorage.setItem(this.STORAGE_KEY, JSON.stringify(stored));\r\n\r\n      // (`📊 Research data logged (${stored.totalComparisons} comparisons)`);\r\n      return true;\r\n    } catch (error) {\r\n      // ('Research data logging failed (non-critical):', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get all stored research data\r\n   * @returns {object} - Complete research dataset\r\n   */\r\n  static getStoredData() {\r\n    try {\r\n      const stored = localStorage.getItem(this.STORAGE_KEY);\r\n      if (!stored) {\r\n        return this.createEmptyDataset();\r\n      }\r\n\r\n      const data = JSON.parse(stored);\r\n\r\n      // Validate structure\r\n      if (!data.entries || !Array.isArray(data.entries)) {\r\n        // ('Invalid research data structure, resetting');\r\n        return this.createEmptyDataset();\r\n      }\r\n\r\n      return data;\r\n    } catch (error) {\r\n      // ('Failed to load research data, creating new:', error);\r\n      return this.createEmptyDataset();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Create empty dataset structure\r\n   * @returns {object} - Empty research dataset\r\n   */\r\n  static createEmptyDataset() {\r\n    return {\r\n      version: '1.0.0',\r\n      created: new Date().toISOString(),\r\n      lastUpdated: null,\r\n      totalComparisons: 0,\r\n      entries: [],\r\n      metadata: {\r\n        app: 'iGFAP Stroke Triage',\r\n        purpose: 'Model comparison research',\r\n        dataRetention: 'Local storage only',\r\n      },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Export research data as CSV for analysis\r\n   * @returns {string} - CSV formatted data\r\n   */\r\n  static exportAsCSV() {\r\n    const data = this.getStoredData();\r\n\r\n    if (!data.entries || data.entries.length === 0) {\r\n      return 'No research data available for export';\r\n    }\r\n\r\n    // CSV headers\r\n    const headers = [\r\n      'timestamp',\r\n      'session_id',\r\n      'age',\r\n      'gfap_value',\r\n      'main_model_probability',\r\n      'main_model_module',\r\n      'legacy_model_probability',\r\n      'legacy_model_confidence',\r\n      'absolute_difference',\r\n      'relative_difference',\r\n      'agreement_level',\r\n      'higher_risk_model',\r\n    ];\r\n\r\n    // Convert entries to CSV rows\r\n    const rows = data.entries.map((entry) => [\r\n      entry.timestamp,\r\n      entry.sessionId,\r\n      entry.inputs?.age || '',\r\n      entry.inputs?.gfap || '',\r\n      entry.main?.probability || '',\r\n      entry.main?.module || '',\r\n      entry.legacy?.probability || '',\r\n      entry.legacy?.confidence || '',\r\n      entry.comparison?.differences?.absolute || '',\r\n      entry.comparison?.differences?.relative || '',\r\n      entry.comparison?.agreement?.level || '',\r\n      entry.comparison?.agreement?.higherRiskModel || '',\r\n    ].join(','));\r\n\r\n    // Combine headers and rows\r\n    const csv = [headers.join(','), ...rows].join('\\n');\r\n    return csv;\r\n  }\r\n\r\n  /**\r\n   * Export research data as JSON for detailed analysis\r\n   * @returns {string} - JSON formatted data\r\n   */\r\n  static exportAsJSON() {\r\n    const data = this.getStoredData();\r\n    return JSON.stringify(data, null, 2);\r\n  }\r\n\r\n  /**\r\n   * Download research data as file\r\n   * @param {string} format - 'csv' or 'json'\r\n   */\r\n  static downloadData(format = 'csv') {\r\n    try {\r\n      const data = format === 'csv' ? this.exportAsCSV() : this.exportAsJSON();\r\n      const filename = `igfap-research-${Date.now()}.${format}`;\r\n\r\n      const blob = new Blob([data], {\r\n        type: format === 'csv' ? 'text/csv' : 'application/json',\r\n      });\r\n\r\n      const url = URL.createObjectURL(blob);\r\n      const link = document.createElement('a');\r\n      link.href = url;\r\n      link.download = filename;\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      document.body.removeChild(link);\r\n      URL.revokeObjectURL(url);\r\n\r\n      // (`📥 Downloaded research data: ${filename}`);\r\n      return true;\r\n    } catch (error) {\r\n      // ('Failed to download research data:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear all stored research data\r\n   */\r\n  static clearData() {\r\n    try {\r\n      localStorage.removeItem(this.STORAGE_KEY);\r\n      // ('🗑️ Research data cleared');\r\n      return true;\r\n    } catch (error) {\r\n      // ('Failed to clear research data:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get summary statistics of stored data\r\n   * @returns {object} - Summary statistics\r\n   */\r\n  static getDataSummary() {\r\n    const data = this.getStoredData();\r\n\r\n    if (!data.entries || data.entries.length === 0) {\r\n      return {\r\n        totalEntries: 0,\r\n        dateRange: null,\r\n        avgDifference: null,\r\n      };\r\n    }\r\n\r\n    const { entries } = data;\r\n    const differences = entries\r\n      .map((e) => e.comparison?.differences?.absolute)\r\n      .filter((d) => d !== undefined && d !== null);\r\n\r\n    const avgDifference = differences.length > 0\r\n      ? differences.reduce((sum, d) => sum + Math.abs(d), 0) / differences.length : 0;\r\n\r\n    return {\r\n      totalEntries: entries.length,\r\n      dateRange: {\r\n        first: entries[0]?.timestamp,\r\n        last: entries[entries.length - 1]?.timestamp,\r\n      },\r\n      avgAbsoluteDifference: Math.round(avgDifference * 10) / 10,\r\n      storageSize: JSON.stringify(data).length,\r\n    };\r\n  }\r\n\r\n  // Utility functions\r\n  static generateEntryId() {\r\n    return Date.now().toString(36) + Math.random().toString(36).substr(2);\r\n  }\r\n\r\n  static getSessionId() {\r\n    let sessionId = sessionStorage.getItem('research_session_id');\r\n    if (!sessionId) {\r\n      sessionId = `session_${Date.now().toString(36)}`;\r\n      sessionStorage.setItem('research_session_id', sessionId);\r\n    }\r\n    return sessionId;\r\n  }\r\n}\r\n\r\n/**\r\n * Safe wrapper for logging research data in production\r\n * @param {object} mainResults - Main model results\r\n * @param {object} legacyResults - Legacy model results\r\n * @param {object} inputs - Patient input data\r\n */\r\nexport function safeLogResearchData(mainResults, legacyResults, inputs) {\r\n  try {\r\n    // Only log if research mode is enabled\r\n    if (!isResearchModeEnabled()) {\r\n      return;\r\n    }\r\n\r\n    const comparisonData = {\r\n      inputs: {\r\n        age: inputs.age_years || inputs.age,\r\n        gfap: inputs.gfap_value || inputs.gfap,\r\n        module: mainResults.module || 'unknown',\r\n      },\r\n      main: {\r\n        probability: mainResults.probability,\r\n        module: mainResults.module,\r\n        confidence: mainResults.confidence,\r\n      },\r\n      legacy: legacyResults,\r\n      comparison: legacyResults\r\n        ? LegacyICHModel.compareModels(mainResults, legacyResults) : null,\r\n    };\r\n\r\n    ResearchDataLogger.logComparison(comparisonData);\r\n  } catch (error) {\r\n    // Silently fail - never break main app functionality\r\n    // ('Research logging failed (non-critical):', error);\r\n  }\r\n}\r\n\r\n/**\r\n * Check if research mode is enabled for current module\r\n * @param {string} module - Current module (coma/limited/full)\r\n * @returns {boolean} - True if research features should be active\r\n */\r\nexport function isResearchModeEnabled(module = null) {\r\n  // Never enable research mode for coma module\r\n  if (module === 'coma') {\r\n    return false;\r\n  }\r\n\r\n  // Always enable for stroke modules (limited/full)\r\n  if (module === 'limited' || module === 'full') {\r\n    return true;\r\n  }\r\n\r\n  // Fallback: check if any stroke module data exists\r\n  if (typeof window !== 'undefined') {\r\n    try {\r\n      const store = window.store || require('../state/store.js')?.store;\r\n      if (store) {\r\n        const { formData } = store.getState();\r\n        const hasStrokeData = formData.limited || formData.full;\r\n        return hasStrokeData; // Enable if stroke module data exists\r\n      }\r\n    } catch (error) {\r\n      // Silently fail - research mode just won't work\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Enable/disable research mode\r\n * @param {boolean} enabled - Enable or disable research mode\r\n */\r\nexport function setResearchMode(enabled) {\r\n  try {\r\n    if (enabled) {\r\n      localStorage.setItem('research_mode', 'true');\r\n      // ('🔬 Research mode enabled');\r\n    } else {\r\n      localStorage.removeItem('research_mode');\r\n      // ('🔬 Research mode disabled');\r\n    }\r\n\r\n    // Trigger page refresh to apply changes\r\n    if (window.location.search.includes('research=')) {\r\n      // Remove research param from URL if disabling\r\n      if (!enabled) {\r\n        const url = new URL(window.location);\r\n        url.searchParams.delete('research');\r\n        window.history.replaceState({}, '', url);\r\n      }\r\n    }\r\n\r\n    return true;\r\n  } catch (error) {\r\n    // ('Failed to toggle research mode:', error);\r\n    return false;\r\n  }\r\n}\r\n","/**\r\n * Research Comparison UI Components\r\n * Hidden by default, activated only for research purposes\r\n */\r\n\r\nimport { t } from '../localization/i18n.js';\r\n\r\nimport { LegacyICHModel } from './legacy-ich-model.js';\r\nimport { ResearchDataLogger, isResearchModeEnabled } from './data-logger.js';\r\n\r\n/**\r\n * Render research toggle button (no longer used - header button handles this)\r\n * @returns {string} - Empty string (header button replaces this)\r\n */\r\nexport function renderResearchToggle() {\r\n  return ''; // Header button now handles research panel toggling\r\n}\r\n\r\n/**\r\n * Render model comparison panel\r\n * @param {object} mainResults - Main model results\r\n * @param {object} legacyResults - Legacy model results\r\n * @param {object} inputs - Patient input data\r\n * @returns {string} - HTML for comparison panel\r\n */\r\nexport function renderModelComparison(mainResults, legacyResults, inputs) {\r\n  // Show debug info if legacy results are invalid\r\n  if (!legacyResults?.isValid) {\r\n    // ('🔬 Legacy model results invalid:', legacyResults);\r\n    return `\r\n      <div class=\"research-panel\" id=\"researchPanel\" style=\"display: none;\">\r\n        <div class=\"research-header\">\r\n          <h4>🔬 Model Comparison (Research)</h4>\r\n          <button class=\"close-research\" id=\"closeResearch\">×</button>\r\n        </div>\r\n        <div class=\"research-error\">\r\n          <p>⚠️ Legacy model calculation failed</p>\r\n          <small>Debug: ${legacyResults?.reason || 'Unknown error'}</small>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  const comparison = LegacyICHModel.compareModels(mainResults, legacyResults);\r\n\r\n  return `\r\n    <div class=\"research-panel\" id=\"researchPanel\" style=\"display: none;\">\r\n      <div class=\"research-header\">\r\n        <h4>🔬 Model Comparison (Research)</h4>\r\n        <button class=\"close-research\" id=\"closeResearch\">×</button>\r\n      </div>\r\n      \r\n      <div class=\"model-comparison\">\r\n        ${renderProbabilityBars(mainResults, legacyResults)}\r\n        ${renderDifferenceAnalysis(comparison)}\r\n        ${renderCalculationDetails(legacyResults, inputs)}\r\n        ${renderModelMetrics()}\r\n      </div>\r\n      \r\n      <div class=\"research-actions\">\r\n        <button id=\"exportResearchData\" class=\"research-btn\">📥 Export Data</button>\r\n        <button id=\"toggleCalculationDetails\" class=\"research-btn\">🧮 Details</button>\r\n        <button id=\"clearResearchData\" class=\"research-btn danger\">🗑️ Clear</button>\r\n      </div>\r\n      \r\n      <div class=\"research-disclaimer\">\r\n        <small>\r\n          ⚠️ <strong>Research Mode Active</strong><br>\r\n          Legacy model: Age + GFAP only (ROC-AUC: 0.789, Recall: 40%)<br>\r\n          For baseline comparison. Main model includes additional clinical factors.\r\n        </small>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render probability comparison bars\r\n * @param {object} mainResults - Main model results\r\n * @param {object} legacyResults - Legacy model results\r\n * @returns {string} - HTML for probability bars\r\n */\r\nfunction renderProbabilityBars(mainResults, legacyResults) {\r\n  // Convert main model probability to percentage if it's in decimal form (0-1)\r\n  let mainProb = mainResults.probability || 0;\r\n  if (mainProb <= 1) {\r\n    mainProb *= 100; // Convert 0.65 to 65%\r\n  }\r\n\r\n  // Legacy model already returns percentage (0-100)\r\n  const legacyProb = legacyResults.probability || 0;\r\n\r\n  return `\r\n    <div class=\"probability-comparison\">\r\n      <div class=\"bar-group\">\r\n        <label class=\"bar-label\">Main Model (Complex) - ${mainResults.module || 'Unknown'}</label>\r\n        <div class=\"probability-bar\">\r\n          <div class=\"bar-fill main-model\" style=\"width: ${Math.max(10, Math.min(mainProb, 100))}%\">\r\n            <span class=\"bar-value\">${mainProb.toFixed(1)}%</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"bar-group\">\r\n        <label class=\"bar-label\">Legacy Model (Age + GFAP Only)</label>\r\n        <div class=\"probability-bar\">\r\n          <div class=\"bar-fill legacy-model\" style=\"width: ${Math.max(10, Math.min(legacyProb, 100))}%\">\r\n            <span class=\"bar-value\">${legacyProb.toFixed(1)}%</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render difference analysis\r\n * @param {object} comparison - Model comparison results\r\n * @returns {string} - HTML for difference analysis\r\n */\r\nfunction renderDifferenceAnalysis(comparison) {\r\n  if (!comparison.isValid) {\r\n    return '<div class=\"comparison-error\">Unable to compare models</div>';\r\n  }\r\n\r\n  const { differences, agreement } = comparison;\r\n  const isMainHigher = differences.absolute > 0;\r\n\r\n  return `\r\n    <div class=\"difference-analysis\">\r\n      <div class=\"difference-metric\">\r\n        <span class=\"metric-label\">Difference:</span>\r\n        <span class=\"metric-value ${isMainHigher ? 'higher' : 'lower'}\">\r\n          ${differences.absolute > 0 ? '+' : ''}${differences.absolute}%\r\n        </span>\r\n      </div>\r\n      \r\n      <div class=\"agreement-level\">\r\n        <span class=\"metric-label\">Agreement:</span>\r\n        <span class=\"agreement-badge ${agreement.level}\">\r\n          ${agreement.level.charAt(0).toUpperCase() + agreement.level.slice(1)}\r\n        </span>\r\n      </div>\r\n      \r\n      <div class=\"interpretation\">\r\n        <p class=\"interpretation-text\">${comparison.interpretation.message}</p>\r\n        <small class=\"interpretation-detail\">${comparison.interpretation.implication}</small>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render calculation details (expandable)\r\n * @param {object} legacyResults - Legacy model results\r\n * @param {object} inputs - Patient input data\r\n * @returns {string} - HTML for calculation details\r\n */\r\nfunction renderCalculationDetails(legacyResults, inputs) {\r\n  return `\r\n    <div class=\"calculation-details\" id=\"calculationDetails\" style=\"display: none;\">\r\n      <h5>Legacy Model Calculation</h5>\r\n      <div class=\"calculation-steps\">\r\n        <div class=\"step\">\r\n          <strong>Inputs:</strong> Age ${inputs.age}, GFAP ${inputs.gfap} pg/ml\r\n        </div>\r\n        <div class=\"step\">\r\n          <strong>Scaling:</strong> Age → ${legacyResults.scaledInputs.age}, GFAP → ${legacyResults.scaledInputs.gfap}\r\n        </div>\r\n        <div class=\"step\">\r\n          <strong>Logit:</strong> ${legacyResults.logit}\r\n        </div>\r\n        <div class=\"step\">\r\n          <strong>Probability:</strong> ${legacyResults.probability}% (Confidence: ${(legacyResults.confidence * 100).toFixed(0)}%)\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Render model performance metrics\r\n * @returns {string} - HTML for model metrics\r\n */\r\nfunction renderModelMetrics() {\r\n  const metadata = LegacyICHModel.getModelMetadata();\r\n\r\n  return `\r\n    <div class=\"model-metrics\">\r\n      <h5>Performance Comparison</h5>\r\n      <div class=\"metrics-grid\">\r\n        <div class=\"metric-item\">\r\n          <span class=\"metric-name\">ROC-AUC</span>\r\n          <span class=\"metric-value\">Legacy: ${metadata.performance.rocAuc}</span>\r\n        </div>\r\n        <div class=\"metric-item\">\r\n          <span class=\"metric-name\">Recall</span>\r\n          <span class=\"metric-value\">Legacy: ${(metadata.performance.recall * 100).toFixed(0)}%</span>\r\n        </div>\r\n        <div class=\"metric-item\">\r\n          <span class=\"metric-name\">Precision</span>\r\n          <span class=\"metric-value\">Legacy: ${(metadata.performance.precision * 100).toFixed(0)}%</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\n/**\r\n * Initialize research mode event handlers\r\n */\r\nexport function initializeResearchMode() {\r\n  // Always initialize if research panel exists\r\n  const researchPanel = document.getElementById('researchPanel');\r\n  if (!researchPanel) {\r\n    return;\r\n  }\r\n\r\n  // Close research panel\r\n  const closeResearch = document.getElementById('closeResearch');\r\n  if (closeResearch) {\r\n    closeResearch.addEventListener('click', () => {\r\n      const panel = document.getElementById('researchPanel');\r\n      if (panel) {\r\n        panel.style.display = 'none';\r\n      }\r\n    });\r\n  }\r\n\r\n  // Export data button\r\n  const exportButton = document.getElementById('exportResearchData');\r\n  if (exportButton) {\r\n    exportButton.addEventListener('click', () => {\r\n      ResearchDataLogger.downloadData('csv');\r\n    });\r\n  }\r\n\r\n  // Toggle calculation details\r\n  const detailsToggle = document.getElementById('toggleCalculationDetails');\r\n  if (detailsToggle) {\r\n    detailsToggle.addEventListener('click', () => {\r\n      const details = document.getElementById('calculationDetails');\r\n      if (details) {\r\n        details.style.display = details.style.display === 'none' ? 'block' : 'none';\r\n        detailsToggle.textContent = details.style.display === 'none' ? '🧮 Details' : '🧮 Hide';\r\n      }\r\n    });\r\n  }\r\n\r\n  // Clear data button\r\n  const clearButton = document.getElementById('clearResearchData');\r\n  if (clearButton) {\r\n    clearButton.addEventListener('click', () => {\r\n      if (confirm('Clear all research data? This cannot be undone.')) {\r\n        ResearchDataLogger.clearData();\r\n\r\n        // Update display\r\n        const summary = ResearchDataLogger.getDataSummary();\r\n        // (`Data cleared. Total entries: ${summary.totalEntries}`);\r\n      }\r\n    });\r\n  }\r\n\r\n  // ('🔬 Research mode initialized');\r\n}\r\n","/**\r\n * Automated Clinical Reporting System\r\n * iGFAP Stroke Triage Assistant - Phase 4 Medical Intelligence\r\n *\r\n * Generates comprehensive clinical reports with AI insights and analytics\r\n */\r\n\r\nimport { medicalEventObserver, MEDICAL_EVENTS } from '../patterns/observer.js';\r\nimport { medicalPerformanceMonitor, PerformanceMetricType } from '../performance/medical-performance-monitor.js';\r\n\r\n/**\r\n * Report types and templates\r\n */\r\nexport const ReportTypes = {\r\n  CLINICAL_SUMMARY: 'clinical_summary',\r\n  OUTCOME_PREDICTION: 'outcome_prediction',\r\n  RISK_ASSESSMENT: 'risk_assessment',\r\n  DECISION_SUPPORT: 'decision_support',\r\n  QUALITY_METRICS: 'quality_metrics',\r\n  RESEARCH_ANALYTICS: 'research_analytics',\r\n  COMPREHENSIVE: 'comprehensive',\r\n};\r\n\r\n/**\r\n * Report formats\r\n */\r\nexport const ReportFormats = {\r\n  PDF: 'pdf',\r\n  HTML: 'html',\r\n  JSON: 'json',\r\n  CSV: 'csv',\r\n  DICOM_SR: 'dicom_sr',\r\n};\r\n\r\n/**\r\n * Report delivery methods\r\n */\r\nexport const DeliveryMethods = {\r\n  DOWNLOAD: 'download',\r\n  EMAIL: 'email',\r\n  EHR_INTEGRATION: 'ehr_integration',\r\n  PACS: 'pacs',\r\n  API: 'api',\r\n};\r\n\r\n/**\r\n * Clinical Report Generator\r\n */\r\nclass ClinicalReportGenerator {\r\n  constructor() {\r\n    this.templates = new Map();\r\n    this.reportHistory = [];\r\n    this.scheduledReports = new Map();\r\n    this.isInitialized = false;\r\n\r\n    this.initializeTemplates();\r\n  }\r\n\r\n  /**\r\n   * Initialize report templates\r\n   */\r\n  initializeTemplates() {\r\n    // Clinical Summary Template\r\n    this.templates.set(ReportTypes.CLINICAL_SUMMARY, {\r\n      name: 'Clinical Summary Report',\r\n      sections: [\r\n        'patient_demographics',\r\n        'clinical_presentation',\r\n        'assessment_findings',\r\n        'risk_stratification',\r\n        'treatment_recommendations',\r\n        'disposition',\r\n      ],\r\n      requiredData: ['patientData', 'predictions'],\r\n      format: 'structured',\r\n    });\r\n\r\n    // Outcome Prediction Template\r\n    this.templates.set(ReportTypes.OUTCOME_PREDICTION, {\r\n      name: 'Outcome Prediction Report',\r\n      sections: [\r\n        'prediction_overview',\r\n        'mortality_risk',\r\n        'functional_outcome',\r\n        'complications_risk',\r\n        'model_performance',\r\n        'confidence_metrics',\r\n      ],\r\n      requiredData: ['predictions', 'mlResults'],\r\n      format: 'analytical',\r\n    });\r\n\r\n    // Risk Assessment Template\r\n    this.templates.set(ReportTypes.RISK_ASSESSMENT, {\r\n      name: 'Risk Assessment Report',\r\n      sections: [\r\n        'risk_profile',\r\n        'hemorrhagic_risk',\r\n        'procedural_risks',\r\n        'contraindications',\r\n        'monitoring_requirements',\r\n        'escalation_criteria',\r\n      ],\r\n      requiredData: ['patientData', 'predictions', 'alerts'],\r\n      format: 'clinical',\r\n    });\r\n\r\n    // Decision Support Template\r\n    this.templates.set(ReportTypes.DECISION_SUPPORT, {\r\n      name: 'Clinical Decision Support Report',\r\n      sections: [\r\n        'treatment_options',\r\n        'evidence_summary',\r\n        'guideline_recommendations',\r\n        'clinical_alerts',\r\n        'action_plan',\r\n        'follow_up',\r\n      ],\r\n      requiredData: ['patientData', 'predictions', 'recommendations'],\r\n      format: 'actionable',\r\n    });\r\n\r\n    // Quality Metrics Template\r\n    this.templates.set(ReportTypes.QUALITY_METRICS, {\r\n      name: 'Quality Metrics Report',\r\n      sections: [\r\n        'performance_indicators',\r\n        'process_metrics',\r\n        'outcome_measures',\r\n        'benchmarking',\r\n        'improvement_opportunities',\r\n        'action_items',\r\n      ],\r\n      requiredData: ['qualityMetrics', 'benchmarks'],\r\n      format: 'dashboard',\r\n    });\r\n\r\n    // Comprehensive Template\r\n    this.templates.set(ReportTypes.COMPREHENSIVE, {\r\n      name: 'Comprehensive Clinical Report',\r\n      sections: [\r\n        'executive_summary',\r\n        'clinical_summary',\r\n        'risk_assessment',\r\n        'outcome_predictions',\r\n        'decision_support',\r\n        'quality_metrics',\r\n        'research_insights',\r\n        'appendices',\r\n      ],\r\n      requiredData: ['all'],\r\n      format: 'comprehensive',\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Generate clinical report\r\n   */\r\n  async generateReport(reportType, data, options = {}) {\r\n    const metricId = medicalPerformanceMonitor.startMeasurement(\r\n      PerformanceMetricType.REPORT_GENERATION,\r\n      `generate_${reportType}_report`,\r\n    );\r\n\r\n    try {\r\n      const template = this.templates.get(reportType);\r\n      if (!template) {\r\n        throw new Error(`Unknown report type: ${reportType}`);\r\n      }\r\n\r\n      // Validate required data\r\n      this.validateReportData(template, data);\r\n\r\n      // Generate report content\r\n      const reportContent = await this.buildReportContent(template, data, options);\r\n\r\n      // Apply formatting\r\n      const formattedReport = await this.formatReport(reportContent, options.format || ReportFormats.HTML);\r\n\r\n      // Create report metadata\r\n      const reportMetadata = {\r\n        id: `report_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n        type: reportType,\r\n        format: options.format || ReportFormats.HTML,\r\n        generated: new Date().toISOString(),\r\n        generator: 'ClinicalReportGenerator',\r\n        version: '1.0',\r\n        patient: data.patientData?.id || 'unknown',\r\n        size: formattedReport.length,\r\n      };\r\n\r\n      // Add to history\r\n      this.reportHistory.push({\r\n        ...reportMetadata,\r\n        dataSnapshot: this.createDataSnapshot(data),\r\n      });\r\n\r\n      medicalPerformanceMonitor.endMeasurement(metricId, { success: true });\r\n\r\n      medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\r\n        action: 'clinical_report_generated',\r\n        reportType,\r\n        reportId: reportMetadata.id,\r\n        patient: reportMetadata.patient,\r\n      });\r\n\r\n      return {\r\n        metadata: reportMetadata,\r\n        content: formattedReport,\r\n        sections: reportContent.sections,\r\n        dataQuality: reportContent.dataQuality,\r\n      };\r\n    } catch (error) {\r\n      medicalPerformanceMonitor.endMeasurement(metricId, {\r\n        success: false,\r\n        error: error.message,\r\n      });\r\n\r\n      // (`Report generation failed for ${reportType}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate report data\r\n   */\r\n  validateReportData(template, data) {\r\n    const missingData = [];\r\n\r\n    for (const requirement of template.requiredData) {\r\n      if (requirement === 'all') {\r\n        continue;\r\n      } // Special case for comprehensive reports\r\n\r\n      if (!data[requirement]) {\r\n        missingData.push(requirement);\r\n      }\r\n    }\r\n\r\n    if (missingData.length > 0) {\r\n      throw new Error(`Missing required data: ${missingData.join(', ')}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Build report content\r\n   */\r\n  async buildReportContent(template, data, options) {\r\n    const sections = {};\r\n    const dataQuality = { score: 100, issues: [] };\r\n\r\n    for (const sectionName of template.sections) {\r\n      try {\r\n        const section = await this.generateSection(sectionName, data, options);\r\n        sections[sectionName] = section;\r\n\r\n        // Update data quality based on section completeness\r\n        if (section.quality && section.quality.score < dataQuality.score) {\r\n          dataQuality.score = section.quality.score;\r\n          dataQuality.issues = dataQuality.issues.concat(section.quality.issues || []);\r\n        }\r\n      } catch (error) {\r\n        // (`Failed to generate section ${sectionName}:`, error);\r\n        sections[sectionName] = {\r\n          title: this.getSectionTitle(sectionName),\r\n          content: `Error generating section: ${error.message}`,\r\n          error: true,\r\n        };\r\n        dataQuality.issues.push(`Section ${sectionName} generation failed`);\r\n      }\r\n    }\r\n\r\n    return {\r\n      template: template.name,\r\n      sections,\r\n      dataQuality,\r\n      generated: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate individual report section\r\n   */\r\n  async generateSection(sectionName, data, options) {\r\n    switch (sectionName) {\r\n      case 'patient_demographics':\r\n        return this.generatePatientDemographics(data.patientData);\r\n\r\n      case 'clinical_presentation':\r\n        return this.generateClinicalPresentation(data.patientData);\r\n\r\n      case 'assessment_findings':\r\n        return this.generateAssessmentFindings(data.patientData, data.predictions);\r\n\r\n      case 'risk_stratification':\r\n        return this.generateRiskStratification(data.predictions);\r\n\r\n      case 'treatment_recommendations':\r\n        return this.generateTreatmentRecommendations(data.recommendations || data.predictions?.recommendations);\r\n\r\n      case 'disposition':\r\n        return this.generateDisposition(data.predictions);\r\n\r\n      case 'prediction_overview':\r\n        return this.generatePredictionOverview(data.predictions);\r\n\r\n      case 'mortality_risk':\r\n        return this.generateMortalityRisk(data.predictions?.mortality);\r\n\r\n      case 'functional_outcome':\r\n        return this.generateFunctionalOutcome(data.predictions?.functionalOutcome);\r\n\r\n      case 'complications_risk':\r\n        return this.generateComplicationsRisk(data.predictions?.complications);\r\n\r\n      case 'model_performance':\r\n        return this.generateModelPerformance(data.mlResults);\r\n\r\n      case 'confidence_metrics':\r\n        return this.generateConfidenceMetrics(data.predictions);\r\n\r\n      case 'risk_profile':\r\n        return this.generateRiskProfile(data.patientData, data.predictions);\r\n\r\n      case 'hemorrhagic_risk':\r\n        return this.generateHemorrhagicRisk(data.predictions?.hemorrhagicRisk);\r\n\r\n      case 'procedural_risks':\r\n        return this.generateProceduralRisks(data.patientData);\r\n\r\n      case 'contraindications':\r\n        return this.generateContraindications(data.patientData);\r\n\r\n      case 'monitoring_requirements':\r\n        return this.generateMonitoringRequirements(data.predictions);\r\n\r\n      case 'escalation_criteria':\r\n        return this.generateEscalationCriteria(data.predictions);\r\n\r\n      case 'treatment_options':\r\n        return this.generateTreatmentOptions(data.patientData, data.predictions);\r\n\r\n      case 'evidence_summary':\r\n        return this.generateEvidenceSummary(data.patientData);\r\n\r\n      case 'guideline_recommendations':\r\n        return this.generateGuidelineRecommendations(data.patientData);\r\n\r\n      case 'clinical_alerts':\r\n        return this.generateClinicalAlerts(data.alerts);\r\n\r\n      case 'action_plan':\r\n        return this.generateActionPlan(data.recommendations);\r\n\r\n      case 'follow_up':\r\n        return this.generateFollowUp(data.predictions);\r\n\r\n      case 'executive_summary':\r\n        return this.generateExecutiveSummary(data);\r\n\r\n      case 'research_insights':\r\n        return this.generateResearchInsights(data);\r\n\r\n      case 'appendices':\r\n        return this.generateAppendices(data);\r\n\r\n      default:\r\n        throw new Error(`Unknown section: ${sectionName}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Generate patient demographics section\r\n   */\r\n  generatePatientDemographics(patientData) {\r\n    const demographics = [];\r\n\r\n    if (patientData.age) {\r\n      demographics.push(`Age: ${patientData.age} years`);\r\n    }\r\n\r\n    if (patientData.gender) {\r\n      demographics.push(`Gender: ${patientData.gender}`);\r\n    }\r\n\r\n    if (patientData.weight) {\r\n      demographics.push(`Weight: ${patientData.weight} kg`);\r\n    }\r\n\r\n    if (patientData.medical_history) {\r\n      demographics.push(`Medical History: ${patientData.medical_history}`);\r\n    }\r\n\r\n    return {\r\n      title: 'Patient Demographics',\r\n      content: demographics.join('; '),\r\n      quality: this.assessDataQuality(['age', 'gender'], patientData),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate clinical presentation section\r\n   */\r\n  generateClinicalPresentation(patientData) {\r\n    const presentation = [];\r\n\r\n    if (patientData.symptom_onset) {\r\n      presentation.push(`Symptom onset: ${patientData.symptom_onset} hours ago`);\r\n    }\r\n\r\n    if (patientData.gcs_score) {\r\n      presentation.push(`Glasgow Coma Scale: ${patientData.gcs_score}/15`);\r\n    }\r\n\r\n    if (patientData.systolic_bp && patientData.diastolic_bp) {\r\n      presentation.push(`Blood Pressure: ${patientData.systolic_bp}/${patientData.diastolic_bp} mmHg`);\r\n    }\r\n\r\n    if (patientData.fast_ed_score) {\r\n      presentation.push(`FAST-ED Score: ${patientData.fast_ed_score}/10`);\r\n    }\r\n\r\n    return {\r\n      title: 'Clinical Presentation',\r\n      content: presentation.join('<br>'),\r\n      quality: this.assessDataQuality(['symptom_onset', 'gcs_score', 'systolic_bp'], patientData),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate assessment findings section\r\n   */\r\n  generateAssessmentFindings(patientData, predictions) {\r\n    const findings = [];\r\n\r\n    if (patientData.gfap_value) {\r\n      const gfap = parseFloat(patientData.gfap_value);\r\n      findings.push(`GFAP Biomarker: ${gfap.toLocaleString()} pg/mL${gfap > 5000 ? ' (Elevated)' : ''}`);\r\n    }\r\n\r\n    if (patientData.ich_volume) {\r\n      findings.push(`ICH Volume: ${patientData.ich_volume} mL`);\r\n    }\r\n\r\n    if (predictions?.lvoDetection) {\r\n      findings.push(`LVO Detection: ${predictions.lvoDetection.probability}% probability`);\r\n    }\r\n\r\n    return {\r\n      title: 'Assessment Findings',\r\n      content: findings.join('<br>'),\r\n      quality: this.assessDataQuality(['gfap_value'], patientData),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate risk stratification section\r\n   */\r\n  generateRiskStratification(predictions) {\r\n    const risks = [];\r\n\r\n    if (predictions?.mortality) {\r\n      const { risk } = predictions.mortality;\r\n      const level = predictions.mortality.riskLevel?.level || 'unknown';\r\n      risks.push(`<strong>Mortality Risk:</strong> ${risk}% (${level})`);\r\n    }\r\n\r\n    if (predictions?.hemorrhagicRisk) {\r\n      const { risk } = predictions.hemorrhagicRisk;\r\n      const level = predictions.hemorrhagicRisk.riskLevel?.level || 'unknown';\r\n      risks.push(`<strong>Hemorrhagic Risk:</strong> ${risk}% (${level})`);\r\n    }\r\n\r\n    if (predictions?.compositeRisk) {\r\n      const { score } = predictions.compositeRisk;\r\n      const level = predictions.compositeRisk.riskLevel?.level || 'unknown';\r\n      risks.push(`<strong>Composite Risk:</strong> ${score}% (${level})`);\r\n    }\r\n\r\n    return {\r\n      title: 'Risk Stratification',\r\n      content: risks.join('<br>'),\r\n      quality: { score: predictions ? 95 : 0, issues: predictions ? [] : ['No predictions available'] },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate treatment recommendations section\r\n   */\r\n  generateTreatmentRecommendations(recommendations) {\r\n    if (!recommendations) {\r\n      return {\r\n        title: 'Treatment Recommendations',\r\n        content: 'No recommendations available',\r\n        quality: { score: 0, issues: ['No recommendations data'] },\r\n      };\r\n    }\r\n\r\n    const recs = [];\r\n\r\n    if (recommendations.priority && recommendations.priority.length > 0) {\r\n      recs.push('<strong>Priority Actions:</strong>');\r\n      recommendations.priority.forEach((rec) => {\r\n        recs.push(`• ${rec.action} (${rec.rationale})`);\r\n      });\r\n    }\r\n\r\n    if (recommendations.standard && recommendations.standard.length > 0) {\r\n      recs.push('<br><strong>Standard Care:</strong>');\r\n      recommendations.standard.forEach((rec) => {\r\n        recs.push(`• ${rec.action} (${rec.rationale})`);\r\n      });\r\n    }\r\n\r\n    return {\r\n      title: 'Treatment Recommendations',\r\n      content: recs.join('<br>'),\r\n      quality: { score: 90, issues: [] },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate disposition section\r\n   */\r\n  generateDisposition(predictions) {\r\n    let disposition = 'Standard stroke unit care';\r\n\r\n    if (predictions?.mortality?.risk > 50) {\r\n      disposition = 'ICU admission recommended due to high mortality risk';\r\n    } else if (predictions?.hemorrhagicRisk?.risk > 40) {\r\n      disposition = 'Enhanced monitoring unit due to hemorrhagic transformation risk';\r\n    } else if (predictions?.compositeRisk?.score > 60) {\r\n      disposition = 'Stroke unit with close monitoring';\r\n    }\r\n\r\n    return {\r\n      title: 'Disposition',\r\n      content: disposition,\r\n      quality: { score: predictions ? 85 : 0, issues: predictions ? [] : ['No predictions for disposition'] },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate prediction overview section\r\n   */\r\n  generatePredictionOverview(predictions) {\r\n    if (!predictions) {\r\n      return {\r\n        title: 'Prediction Overview',\r\n        content: 'No predictions available',\r\n        quality: { score: 0, issues: ['No predictions data'] },\r\n      };\r\n    }\r\n\r\n    const overview = [\r\n      '<table class=\"prediction-table\">',\r\n      '<tr><th>Outcome</th><th>Prediction</th><th>Confidence</th></tr>',\r\n    ];\r\n\r\n    if (predictions.mortality) {\r\n      overview.push(`<tr><td>30-Day Mortality</td><td>${predictions.mortality.risk}%</td><td>${predictions.mortality.confidence?.level || 'N/A'}</td></tr>`);\r\n    }\r\n\r\n    if (predictions.functionalOutcome) {\r\n      overview.push(`<tr><td>Good Functional Outcome</td><td>${predictions.functionalOutcome.probability}%</td><td>${predictions.functionalOutcome.confidence?.level || 'N/A'}</td></tr>`);\r\n    }\r\n\r\n    if (predictions.hemorrhagicRisk) {\r\n      overview.push(`<tr><td>Hemorrhagic Transformation</td><td>${predictions.hemorrhagicRisk.risk}%</td><td>High</td></tr>`);\r\n    }\r\n\r\n    overview.push('</table>');\r\n\r\n    return {\r\n      title: 'Prediction Overview',\r\n      content: overview.join(''),\r\n      quality: { score: 95, issues: [] },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate mortality risk section\r\n   */\r\n  generateMortalityRisk(mortalityData) {\r\n    if (!mortalityData) {\r\n      return {\r\n        title: 'Mortality Risk',\r\n        content: 'Mortality risk assessment not available',\r\n        quality: { score: 0, issues: ['No mortality data'] },\r\n      };\r\n    }\r\n\r\n    const content = [\r\n      `<p><strong>30-Day Mortality Risk:</strong> ${mortalityData.risk}%</p>`,\r\n      `<p><strong>Risk Level:</strong> ${mortalityData.riskLevel?.label || 'Unknown'}</p>`,\r\n      `<p><strong>Confidence:</strong> ${mortalityData.confidence?.level || 'Unknown'} (${mortalityData.confidence?.percent || 0}%)</p>`,\r\n    ];\r\n\r\n    if (mortalityData.explanation) {\r\n      content.push(`<p><strong>Explanation:</strong> ${mortalityData.explanation}</p>`);\r\n    }\r\n\r\n    if (mortalityData.factors && mortalityData.factors.length > 0) {\r\n      content.push('<p><strong>Contributing Factors:</strong></p>');\r\n      content.push('<ul>');\r\n      mortalityData.factors.forEach((factor) => {\r\n        content.push(`<li>${factor.name}: ${factor.impact} impact (weight: ${Math.round((factor.weight || 0) * 100)}%)</li>`);\r\n      });\r\n      content.push('</ul>');\r\n    }\r\n\r\n    return {\r\n      title: 'Mortality Risk Analysis',\r\n      content: content.join(''),\r\n      quality: { score: 95, issues: [] },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate functional outcome section\r\n   */\r\n  generateFunctionalOutcome(functionalData) {\r\n    if (!functionalData) {\r\n      return {\r\n        title: 'Functional Outcome',\r\n        content: 'Functional outcome prediction not available',\r\n        quality: { score: 0, issues: ['No functional outcome data'] },\r\n      };\r\n    }\r\n\r\n    const content = [\r\n      `<p><strong>Probability of Good Outcome (mRS 0-2):</strong> ${functionalData.probability}%</p>`,\r\n      `<p><strong>Predicted Outcome:</strong> ${functionalData.outcome}</p>`,\r\n      `<p><strong>Confidence:</strong> ${functionalData.confidence?.level || 'Unknown'}</p>`,\r\n    ];\r\n\r\n    if (functionalData.factors && functionalData.factors.length > 0) {\r\n      content.push('<p><strong>Influencing Factors:</strong></p>');\r\n      content.push('<ul>');\r\n      functionalData.factors.forEach((factor) => {\r\n        content.push(`<li>${factor.name}: ${factor.impact} impact - ${factor.description}</li>`);\r\n      });\r\n      content.push('</ul>');\r\n    }\r\n\r\n    return {\r\n      title: 'Functional Outcome Prediction',\r\n      content: content.join(''),\r\n      quality: { score: 90, issues: [] },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate executive summary\r\n   */\r\n  generateExecutiveSummary(data) {\r\n    const summary = [];\r\n\r\n    // Patient overview\r\n    if (data.patientData?.age) {\r\n      summary.push(`${data.patientData.age}-year-old patient presenting with stroke symptoms.`);\r\n    }\r\n\r\n    // Key findings\r\n    if (data.patientData?.gfap_value) {\r\n      const gfap = parseFloat(data.patientData.gfap_value);\r\n      summary.push(`GFAP level: ${gfap.toLocaleString()} pg/mL${gfap > 5000 ? ' (significantly elevated)' : ''}.`);\r\n    }\r\n\r\n    // Risk assessment\r\n    if (data.predictions?.compositeRisk) {\r\n      const risk = data.predictions.compositeRisk.score;\r\n      const level = data.predictions.compositeRisk.riskLevel?.level || 'unknown';\r\n      summary.push(`Overall risk assessment: ${risk}% (${level} risk).`);\r\n    }\r\n\r\n    // Recommendations\r\n    if (data.predictions?.recommendations?.summary) {\r\n      summary.push(data.predictions.recommendations.summary);\r\n    }\r\n\r\n    return {\r\n      title: 'Executive Summary',\r\n      content: summary.join(' '),\r\n      quality: { score: 85, issues: [] },\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Assess data quality for a section\r\n   */\r\n  assessDataQuality(requiredFields, data) {\r\n    const availableFields = requiredFields.filter((field) => data[field] !== undefined && data[field] !== null && data[field] !== '');\r\n\r\n    const score = (availableFields.length / requiredFields.length) * 100;\r\n    const missingFields = requiredFields.filter((field) => !availableFields.includes(field));\r\n\r\n    return {\r\n      score: Math.round(score),\r\n      issues: missingFields.length > 0 ? [`Missing data: ${missingFields.join(', ')}`] : [],\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get section title\r\n   */\r\n  getSectionTitle(sectionName) {\r\n    const titles = {\r\n      patient_demographics: 'Patient Demographics',\r\n      clinical_presentation: 'Clinical Presentation',\r\n      assessment_findings: 'Assessment Findings',\r\n      risk_stratification: 'Risk Stratification',\r\n      treatment_recommendations: 'Treatment Recommendations',\r\n      disposition: 'Disposition',\r\n      prediction_overview: 'Prediction Overview',\r\n      mortality_risk: 'Mortality Risk',\r\n      functional_outcome: 'Functional Outcome',\r\n      complications_risk: 'Complications Risk',\r\n      model_performance: 'Model Performance',\r\n      confidence_metrics: 'Confidence Metrics',\r\n      executive_summary: 'Executive Summary',\r\n    };\r\n\r\n    return titles[sectionName] || sectionName.replace(/_/g, ' ').replace(/\\b\\w/g, (l) => l.toUpperCase());\r\n  }\r\n\r\n  /**\r\n   * Format report content\r\n   */\r\n  async formatReport(reportContent, format) {\r\n    switch (format) {\r\n      case ReportFormats.HTML:\r\n        return this.formatAsHTML(reportContent);\r\n\r\n      case ReportFormats.PDF:\r\n        return this.formatAsPDF(reportContent);\r\n\r\n      case ReportFormats.JSON:\r\n        return JSON.stringify(reportContent, null, 2);\r\n\r\n      case ReportFormats.CSV:\r\n        return this.formatAsCSV(reportContent);\r\n\r\n      default:\r\n        return this.formatAsHTML(reportContent);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Format report as HTML\r\n   */\r\n  formatAsHTML(reportContent) {\r\n    const html = [\r\n      '<!DOCTYPE html>',\r\n      '<html lang=\"en\">',\r\n      '<head>',\r\n      '<meta charset=\"UTF-8\">',\r\n      '<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">',\r\n      `<title>${reportContent.template}</title>`,\r\n      '<style>',\r\n      this.getReportCSS(),\r\n      '</style>',\r\n      '</head>',\r\n      '<body>',\r\n      '<div class=\"report-container\">',\r\n      '<header class=\"report-header\">',\r\n      `<h1>${reportContent.template}</h1>`,\r\n      `<div class=\"report-meta\">Generated: ${reportContent.generated}</div>`,\r\n      `<div class=\"data-quality\">Data Quality: ${reportContent.dataQuality.score}%</div>`,\r\n      '</header>',\r\n      '<main class=\"report-content\">',\r\n    ];\r\n\r\n    // Add sections\r\n    Object.entries(reportContent.sections).forEach(([sectionName, section]) => {\r\n      html.push(`<section class=\"report-section\" id=\"${sectionName}\">`);\r\n      html.push(`<h2>${section.title}</h2>`);\r\n      html.push(`<div class=\"section-content\">${section.content}</div>`);\r\n      if (section.quality && section.quality.score < 100) {\r\n        html.push(`<div class=\"quality-indicator\">Quality: ${section.quality.score}%</div>`);\r\n      }\r\n      html.push('</section>');\r\n    });\r\n\r\n    html.push('</main>');\r\n    html.push('</div>');\r\n    html.push('</body>');\r\n    html.push('</html>');\r\n\r\n    return html.join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Get report CSS styles\r\n   */\r\n  getReportCSS() {\r\n    return `\r\n      body {\r\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\r\n        line-height: 1.6;\r\n        margin: 0;\r\n        padding: 20px;\r\n        background: #f5f5f5;\r\n      }\r\n\r\n      .report-container {\r\n        max-width: 1200px;\r\n        margin: 0 auto;\r\n        background: white;\r\n        box-shadow: 0 0 10px rgba(0,0,0,0.1);\r\n        border-radius: 8px;\r\n        overflow: hidden;\r\n      }\r\n\r\n      .report-header {\r\n        background: #2196F3;\r\n        color: white;\r\n        padding: 30px;\r\n        text-align: center;\r\n      }\r\n\r\n      .report-header h1 {\r\n        margin: 0 0 10px 0;\r\n        font-size: 2.5em;\r\n      }\r\n\r\n      .report-meta {\r\n        font-size: 0.9em;\r\n        opacity: 0.9;\r\n      }\r\n\r\n      .data-quality {\r\n        margin-top: 10px;\r\n        padding: 5px 15px;\r\n        background: rgba(255,255,255,0.2);\r\n        border-radius: 20px;\r\n        display: inline-block;\r\n      }\r\n\r\n      .report-content {\r\n        padding: 40px;\r\n      }\r\n\r\n      .report-section {\r\n        margin-bottom: 40px;\r\n        border-bottom: 1px solid #e0e0e0;\r\n        padding-bottom: 30px;\r\n      }\r\n\r\n      .report-section:last-child {\r\n        border-bottom: none;\r\n      }\r\n\r\n      .report-section h2 {\r\n        color: #2196F3;\r\n        margin: 0 0 20px 0;\r\n        font-size: 1.8em;\r\n        border-left: 4px solid #2196F3;\r\n        padding-left: 15px;\r\n      }\r\n\r\n      .section-content {\r\n        font-size: 1.1em;\r\n        line-height: 1.8;\r\n      }\r\n\r\n      .quality-indicator {\r\n        margin-top: 10px;\r\n        font-size: 0.8em;\r\n        color: #666;\r\n        text-align: right;\r\n      }\r\n\r\n      .prediction-table {\r\n        width: 100%;\r\n        border-collapse: collapse;\r\n        margin: 20px 0;\r\n      }\r\n\r\n      .prediction-table th,\r\n      .prediction-table td {\r\n        border: 1px solid #ddd;\r\n        padding: 12px;\r\n        text-align: left;\r\n      }\r\n\r\n      .prediction-table th {\r\n        background: #f5f5f5;\r\n        font-weight: bold;\r\n      }\r\n\r\n      .prediction-table tr:nth-child(even) {\r\n        background: #f9f9f9;\r\n      }\r\n\r\n      ul {\r\n        margin: 15px 0;\r\n      }\r\n\r\n      li {\r\n        margin: 5px 0;\r\n      }\r\n\r\n      p {\r\n        margin: 15px 0;\r\n      }\r\n\r\n      strong {\r\n        color: #333;\r\n      }\r\n\r\n      @media print {\r\n        body {\r\n          background: white;\r\n          padding: 0;\r\n        }\r\n\r\n        .report-container {\r\n          box-shadow: none;\r\n          border-radius: 0;\r\n        }\r\n\r\n        .report-section {\r\n          page-break-inside: avoid;\r\n        }\r\n      }\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Create data snapshot for history\r\n   */\r\n  createDataSnapshot(data) {\r\n    return {\r\n      hasPatientData: !!data.patientData,\r\n      hasPredictions: !!data.predictions,\r\n      hasMLResults: !!data.mlResults,\r\n      hasRecommendations: !!data.recommendations,\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Generate additional sections (simplified implementations)\r\n   */\r\n  generateClinicalAlerts(alerts) {\r\n    if (!alerts || alerts.length === 0) {\r\n      return {\r\n        title: 'Clinical Alerts',\r\n        content: 'No active alerts',\r\n        quality: { score: 100, issues: [] },\r\n      };\r\n    }\r\n\r\n    const alertsHtml = alerts.map((alert) => `<div class=\"alert ${alert.severity?.level}\">\r\n        <strong>${alert.title}</strong><br>\r\n        ${alert.message}<br>\r\n        <em>Recommendation: ${alert.recommendation}</em>\r\n      </div>`).join('');\r\n\r\n    return {\r\n      title: 'Clinical Alerts',\r\n      content: alertsHtml,\r\n      quality: { score: 95, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateHemorrhagicRisk(hemorrhagicData) {\r\n    if (!hemorrhagicData) {\r\n      return {\r\n        title: 'Hemorrhagic Risk',\r\n        content: 'Hemorrhagic risk assessment not available',\r\n        quality: { score: 0, issues: ['No hemorrhagic risk data'] },\r\n      };\r\n    }\r\n\r\n    const content = [\r\n      `<p><strong>Hemorrhagic Transformation Risk:</strong> ${hemorrhagicData.risk}%</p>`,\r\n      `<p><strong>Risk Level:</strong> ${hemorrhagicData.riskLevel?.label || 'Unknown'}</p>`,\r\n      `<p><strong>Recommendation:</strong> ${hemorrhagicData.recommendation}</p>`,\r\n    ];\r\n\r\n    if (hemorrhagicData.activeFactors && hemorrhagicData.activeFactors.length > 0) {\r\n      content.push('<p><strong>Active Risk Factors:</strong></p>');\r\n      content.push('<ul>');\r\n      hemorrhagicData.activeFactors.forEach((factor) => {\r\n        content.push(`<li>${factor.factor}: ${factor.contribution}% contribution</li>`);\r\n      });\r\n      content.push('</ul>');\r\n    }\r\n\r\n    return {\r\n      title: 'Hemorrhagic Transformation Risk',\r\n      content: content.join(''),\r\n      quality: { score: 90, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateResearchInsights(data) {\r\n    return {\r\n      title: 'Research Insights',\r\n      content: 'Research analytics and population-based insights would be generated here based on anonymized data comparisons.',\r\n      quality: { score: 70, issues: ['Research module not fully implemented'] },\r\n    };\r\n  }\r\n\r\n  generateAppendices(data) {\r\n    return {\r\n      title: 'Appendices',\r\n      content: 'Technical details, model specifications, and additional data would be included in appendices.',\r\n      quality: { score: 80, issues: [] },\r\n    };\r\n  }\r\n\r\n  // Additional simplified generators for remaining sections\r\n  generateModelPerformance(mlResults) {\r\n    return {\r\n      title: 'Model Performance',\r\n      content: mlResults ? 'Model performance metrics and validation results.' : 'No ML results available.',\r\n      quality: { score: mlResults ? 85 : 0, issues: mlResults ? [] : ['No ML results'] },\r\n    };\r\n  }\r\n\r\n  generateConfidenceMetrics(predictions) {\r\n    return {\r\n      title: 'Confidence Metrics',\r\n      content: predictions ? 'Prediction confidence analysis and reliability metrics.' : 'No predictions available.',\r\n      quality: { score: predictions ? 90 : 0, issues: predictions ? [] : ['No predictions'] },\r\n    };\r\n  }\r\n\r\n  generateRiskProfile(patientData, predictions) {\r\n    return {\r\n      title: 'Risk Profile',\r\n      content: 'Comprehensive risk profile based on clinical and predictive factors.',\r\n      quality: { score: 85, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateProceduralRisks(patientData) {\r\n    return {\r\n      title: 'Procedural Risks',\r\n      content: 'Assessment of risks associated with potential interventions.',\r\n      quality: { score: 80, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateContraindications(patientData) {\r\n    return {\r\n      title: 'Contraindications',\r\n      content: 'Analysis of contraindications for various treatment options.',\r\n      quality: { score: 85, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateMonitoringRequirements(predictions) {\r\n    return {\r\n      title: 'Monitoring Requirements',\r\n      content: 'Recommended monitoring protocols based on risk assessment.',\r\n      quality: { score: 90, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateEscalationCriteria(predictions) {\r\n    return {\r\n      title: 'Escalation Criteria',\r\n      content: 'Criteria for escalating care based on clinical deterioration.',\r\n      quality: { score: 85, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateTreatmentOptions(patientData, predictions) {\r\n    return {\r\n      title: 'Treatment Options',\r\n      content: 'Available treatment options with risk-benefit analysis.',\r\n      quality: { score: 88, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateEvidenceSummary(patientData) {\r\n    return {\r\n      title: 'Evidence Summary',\r\n      content: 'Summary of relevant clinical evidence and guidelines.',\r\n      quality: { score: 75, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateGuidelineRecommendations(patientData) {\r\n    return {\r\n      title: 'Guideline Recommendations',\r\n      content: 'Relevant clinical guideline recommendations.',\r\n      quality: { score: 85, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateActionPlan(recommendations) {\r\n    return {\r\n      title: 'Action Plan',\r\n      content: recommendations ? 'Structured action plan based on recommendations.' : 'No recommendations available.',\r\n      quality: { score: recommendations ? 90 : 0, issues: recommendations ? [] : ['No recommendations'] },\r\n    };\r\n  }\r\n\r\n  generateFollowUp(predictions) {\r\n    return {\r\n      title: 'Follow-up',\r\n      content: 'Recommended follow-up schedule and monitoring plan.',\r\n      quality: { score: 85, issues: [] },\r\n    };\r\n  }\r\n\r\n  generateComplicationsRisk(complicationsData) {\r\n    if (!complicationsData) {\r\n      return {\r\n        title: 'Complications Risk',\r\n        content: 'Complications risk assessment not available',\r\n        quality: { score: 0, issues: ['No complications data'] },\r\n      };\r\n    }\r\n\r\n    const content = [`<p><strong>Overall Complications Risk:</strong> ${complicationsData.totalRisk}%</p>`];\r\n\r\n    if (complicationsData.complications && complicationsData.complications.length > 0) {\r\n      content.push('<p><strong>Specific Complications:</strong></p>');\r\n      content.push('<ul>');\r\n      complicationsData.complications.forEach((comp) => {\r\n        content.push(`<li>${comp.type}: ${comp.risk}% risk</li>`);\r\n      });\r\n      content.push('</ul>');\r\n    }\r\n\r\n    return {\r\n      title: 'Complications Risk Assessment',\r\n      content: content.join(''),\r\n      quality: { score: 90, issues: [] },\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Automated Clinical Reporting System\r\n */\r\nexport class ClinicalReportingSystem {\r\n  constructor() {\r\n    this.reportGenerator = new ClinicalReportGenerator();\r\n    this.scheduledReports = new Map();\r\n    this.deliveryQueue = [];\r\n    this.isActive = false;\r\n  }\r\n\r\n  /**\r\n   * Start the reporting system\r\n   */\r\n  start() {\r\n    this.isActive = true;\r\n    this.processDeliveryQueue();\r\n\r\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\r\n      action: 'clinical_reporting_system_started',\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Generate comprehensive report\r\n   */\r\n  async generateComprehensiveReport(data, options = {}) {\r\n    return await this.reportGenerator.generateReport(ReportTypes.COMPREHENSIVE, data, options);\r\n  }\r\n\r\n  /**\r\n   * Generate specific report type\r\n   */\r\n  async generateReport(reportType, data, options = {}) {\r\n    return await this.reportGenerator.generateReport(reportType, data, options);\r\n  }\r\n\r\n  /**\r\n   * Schedule automated report generation\r\n   */\r\n  scheduleReport(schedule) {\r\n    const scheduleId = `schedule_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n\r\n    this.scheduledReports.set(scheduleId, {\r\n      ...schedule,\r\n      id: scheduleId,\r\n      created: new Date().toISOString(),\r\n      lastGenerated: null,\r\n      nextGeneration: this.calculateNextGeneration(schedule.frequency),\r\n    });\r\n\r\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\r\n      action: 'report_scheduled',\r\n      scheduleId,\r\n      reportType: schedule.reportType,\r\n    });\r\n\r\n    return scheduleId;\r\n  }\r\n\r\n  /**\r\n   * Queue report for delivery\r\n   */\r\n  queueReportForDelivery(report, deliveryMethod, deliveryOptions = {}) {\r\n    this.deliveryQueue.push({\r\n      report,\r\n      deliveryMethod,\r\n      deliveryOptions,\r\n      queued: new Date().toISOString(),\r\n      attempts: 0,\r\n      maxAttempts: 3,\r\n    });\r\n\r\n    if (this.isActive) {\r\n      this.processDeliveryQueue();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process delivery queue\r\n   */\r\n  async processDeliveryQueue() {\r\n    while (this.deliveryQueue.length > 0 && this.isActive) {\r\n      const deliveryItem = this.deliveryQueue.shift();\r\n\r\n      try {\r\n        await this.deliverReport(deliveryItem);\r\n      } catch (error) {\r\n        deliveryItem.attempts++;\r\n        if (deliveryItem.attempts < deliveryItem.maxAttempts) {\r\n          // Retry later\r\n          setTimeout(() => {\r\n            this.deliveryQueue.push(deliveryItem);\r\n          }, 60000 * deliveryItem.attempts); // Exponential backoff\r\n        } else {\r\n          // ('Failed to deliver report after max attempts:', error);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Process again in 30 seconds\r\n    if (this.isActive) {\r\n      setTimeout(() => this.processDeliveryQueue(), 30000);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Deliver report using specified method\r\n   */\r\n  async deliverReport(deliveryItem) {\r\n    const { report, deliveryMethod, deliveryOptions } = deliveryItem;\r\n\r\n    switch (deliveryMethod) {\r\n      case DeliveryMethods.DOWNLOAD:\r\n        this.triggerDownload(report);\r\n        break;\r\n\r\n      case DeliveryMethods.EMAIL:\r\n        await this.emailReport(report, deliveryOptions);\r\n        break;\r\n\r\n      case DeliveryMethods.EHR_INTEGRATION:\r\n        await this.integrateWithEHR(report, deliveryOptions);\r\n        break;\r\n\r\n      case DeliveryMethods.API:\r\n        await this.sendToAPI(report, deliveryOptions);\r\n        break;\r\n\r\n      default:\r\n        throw new Error(`Unknown delivery method: ${deliveryMethod}`);\r\n    }\r\n\r\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\r\n      action: 'report_delivered',\r\n      reportId: report.metadata.id,\r\n      deliveryMethod,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Trigger report download\r\n   */\r\n  triggerDownload(report) {\r\n    const blob = new Blob([report.content], { type: 'text/html' });\r\n    const url = URL.createObjectURL(blob);\r\n\r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = `clinical-report-${report.metadata.id}.html`;\r\n    link.click();\r\n\r\n    URL.revokeObjectURL(url);\r\n  }\r\n\r\n  /**\r\n   * Email report (simulated)\r\n   */\r\n  async emailReport(report, options) {\r\n    // In real implementation, this would integrate with email service\r\n    // (`Email report ${report.metadata.id} to ${options.recipient}`);\r\n  }\r\n\r\n  /**\r\n   * Integrate with EHR (simulated)\r\n   */\r\n  async integrateWithEHR(report, options) {\r\n    // In real implementation, this would integrate with EHR system\r\n    // (`Integrate report ${report.metadata.id} with EHR system`);\r\n  }\r\n\r\n  /**\r\n   * Send to API (simulated)\r\n   */\r\n  async sendToAPI(report, options) {\r\n    // In real implementation, this would send to external API\r\n    // (`Send report ${report.metadata.id} to API endpoint`);\r\n  }\r\n\r\n  /**\r\n   * Calculate next generation time\r\n   */\r\n  calculateNextGeneration(frequency) {\r\n    const now = new Date();\r\n    switch (frequency) {\r\n      case 'daily':\r\n        return new Date(now.getTime() + 24 * 60 * 60 * 1000).toISOString();\r\n      case 'weekly':\r\n        return new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000).toISOString();\r\n      case 'monthly':\r\n        return new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000).toISOString();\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get report history\r\n   */\r\n  getReportHistory(filters = {}) {\r\n    return this.reportGenerator.reportHistory.filter((report) => {\r\n      if (filters.reportType && report.type !== filters.reportType) {\r\n        return false;\r\n      }\r\n      if (filters.startDate && new Date(report.generated) < new Date(filters.startDate)) {\r\n        return false;\r\n      }\r\n      if (filters.endDate && new Date(report.generated) > new Date(filters.endDate)) {\r\n        return false;\r\n      }\r\n      return true;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Export reporting statistics\r\n   */\r\n  getReportingStatistics() {\r\n    const history = this.reportGenerator.reportHistory;\r\n\r\n    return {\r\n      totalReports: history.length,\r\n      reportsByType: this.groupBy(history, 'type'),\r\n      averageDataQuality: this.calculateAverageDataQuality(history),\r\n      reportingTrends: this.calculateReportingTrends(history),\r\n      scheduledReports: this.scheduledReports.size,\r\n      queuedDeliveries: this.deliveryQueue.length,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Helper methods\r\n   */\r\n  groupBy(array, key) {\r\n    return array.reduce((result, item) => {\r\n      const group = item[key] || 'unknown';\r\n      result[group] = (result[group] || 0) + 1;\r\n      return result;\r\n    }, {});\r\n  }\r\n\r\n  calculateAverageDataQuality(history) {\r\n    if (history.length === 0) {\r\n      return 0;\r\n    }\r\n\r\n    const totalQuality = history.reduce(\r\n      (sum, report) => sum + (report.dataSnapshot?.quality || 85), // Default quality\r\n      0,\r\n    );\r\n\r\n    return Math.round(totalQuality / history.length);\r\n  }\r\n\r\n  calculateReportingTrends(history) {\r\n    // Simplified trend calculation\r\n    const last30Days = history.filter((report) => new Date(report.generated) > new Date(Date.now() - 30 * 24 * 60 * 60 * 1000));\r\n\r\n    return {\r\n      reportsLast30Days: last30Days.length,\r\n      averageReportsPerDay: Math.round(last30Days.length / 30 * 10) / 10,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Stop the reporting system\r\n   */\r\n  stop() {\r\n    this.isActive = false;\r\n\r\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\r\n      action: 'clinical_reporting_system_stopped',\r\n    });\r\n  }\r\n}\r\n\r\n// Export reporting system instance\r\nexport const clinicalReportingSystem = new ClinicalReportingSystem();\r\n","/**\r\n * Quality Metrics Tracking System\r\n * iGFAP Stroke Triage Assistant - Phase 4 Medical Intelligence\r\n *\r\n * Comprehensive quality metrics and performance tracking for clinical outcomes\r\n */\r\n\r\nimport { medicalEventObserver, MEDICAL_EVENTS } from '../patterns/observer.js';\r\nimport { medicalPerformanceMonitor, PerformanceMetricType } from '../performance/medical-performance-monitor.js';\r\nimport { predictionCache } from '../performance/medical-cache.js';\r\n\r\n/**\r\n * Quality metric categories\r\n */\r\nexport const QualityCategories = {\r\n  PROCESS: 'process',\r\n  OUTCOME: 'outcome',\r\n  STRUCTURE: 'structure',\r\n  SAFETY: 'safety',\r\n  EFFICIENCY: 'efficiency',\r\n  PATIENT_EXPERIENCE: 'patient_experience',\r\n};\r\n\r\n/**\r\n * Clinical quality indicators\r\n */\r\nexport const ClinicalIndicators = {\r\n  DOOR_TO_NEEDLE_TIME: 'door_to_needle_time',\r\n  DOOR_TO_IMAGING_TIME: 'door_to_imaging_time',\r\n  IMAGING_TO_DECISION_TIME: 'imaging_to_decision_time',\r\n  MORTALITY_RATE_30D: 'mortality_rate_30d',\r\n  FUNCTIONAL_INDEPENDENCE_90D: 'functional_independence_90d',\r\n  HEMORRHAGIC_TRANSFORMATION_RATE: 'hemorrhagic_transformation_rate',\r\n  THROMBOLYSIS_RATE: 'thrombolysis_rate',\r\n  MECHANICAL_THROMBECTOMY_RATE: 'mechanical_thrombectomy_rate',\r\n  PREDICTION_ACCURACY: 'prediction_accuracy',\r\n  MODEL_CALIBRATION: 'model_calibration',\r\n  ALERT_APPROPRIATENESS: 'alert_appropriateness',\r\n  GUIDELINE_ADHERENCE: 'guideline_adherence',\r\n};\r\n\r\n/**\r\n * Benchmarking standards\r\n */\r\nexport const QualityBenchmarks = {\r\n  [ClinicalIndicators.DOOR_TO_NEEDLE_TIME]: {\r\n    target: 60, // minutes\r\n    excellent: 45,\r\n    good: 60,\r\n    acceptable: 90,\r\n    unit: 'minutes',\r\n  },\r\n  [ClinicalIndicators.DOOR_TO_IMAGING_TIME]: {\r\n    target: 25, // minutes\r\n    excellent: 20,\r\n    good: 25,\r\n    acceptable: 45,\r\n    unit: 'minutes',\r\n  },\r\n  [ClinicalIndicators.MORTALITY_RATE_30D]: {\r\n    target: 15, // percentage\r\n    excellent: 10,\r\n    good: 15,\r\n    acceptable: 20,\r\n    unit: 'percentage',\r\n  },\r\n  [ClinicalIndicators.FUNCTIONAL_INDEPENDENCE_90D]: {\r\n    target: 50, // percentage\r\n    excellent: 60,\r\n    good: 50,\r\n    acceptable: 40,\r\n    unit: 'percentage',\r\n  },\r\n  [ClinicalIndicators.THROMBOLYSIS_RATE]: {\r\n    target: 15, // percentage of eligible patients\r\n    excellent: 20,\r\n    good: 15,\r\n    acceptable: 10,\r\n    unit: 'percentage',\r\n  },\r\n  [ClinicalIndicators.PREDICTION_ACCURACY]: {\r\n    target: 85, // percentage\r\n    excellent: 90,\r\n    good: 85,\r\n    acceptable: 80,\r\n    unit: 'percentage',\r\n  },\r\n};\r\n\r\n/**\r\n * Quality metric data structure\r\n */\r\nclass QualityMetric {\r\n  constructor(indicator, category, value, timestamp, metadata = {}) {\r\n    this.indicator = indicator;\r\n    this.category = category;\r\n    this.value = value;\r\n    this.timestamp = timestamp;\r\n    this.metadata = metadata;\r\n    this.benchmark = QualityBenchmarks[indicator];\r\n    this.performance = this.calculatePerformance();\r\n  }\r\n\r\n  /**\r\n   * Calculate performance against benchmark\r\n   */\r\n  calculatePerformance() {\r\n    if (!this.benchmark) {\r\n      return { level: 'unknown', score: null };\r\n    }\r\n\r\n    const { excellent, good, acceptable } = this.benchmark;\r\n\r\n    // For metrics where lower is better (e.g., time metrics)\r\n    const isLowerBetter = this.indicator.includes('time') || this.indicator.includes('mortality');\r\n\r\n    let level; let\r\n      score;\r\n\r\n    if (isLowerBetter) {\r\n      if (this.value <= excellent) {\r\n        level = 'excellent';\r\n        score = 100;\r\n      } else if (this.value <= good) {\r\n        level = 'good';\r\n        score = 85;\r\n      } else if (this.value <= acceptable) {\r\n        level = 'acceptable';\r\n        score = 70;\r\n      } else {\r\n        level = 'needs_improvement';\r\n        score = Math.max(0, 50 - ((this.value - acceptable) / acceptable) * 25);\r\n      }\r\n    } else {\r\n      // For metrics where higher is better (e.g., rates, accuracy)\r\n      if (this.value >= excellent) {\r\n        level = 'excellent';\r\n        score = 100;\r\n      } else if (this.value >= good) {\r\n        level = 'good';\r\n        score = 85;\r\n      } else if (this.value >= acceptable) {\r\n        level = 'acceptable';\r\n        score = 70;\r\n      } else {\r\n        level = 'needs_improvement';\r\n        score = Math.max(0, (this.value / acceptable) * 70);\r\n      }\r\n    }\r\n\r\n    return { level, score: Math.round(score) };\r\n  }\r\n\r\n  /**\r\n   * Get performance status\r\n   */\r\n  getStatus() {\r\n    return {\r\n      indicator: this.indicator,\r\n      value: this.value,\r\n      benchmark: this.benchmark,\r\n      performance: this.performance,\r\n      timestamp: this.timestamp,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Quality metrics aggregator\r\n */\r\nclass QualityAggregator {\r\n  constructor() {\r\n    this.metrics = [];\r\n    this.aggregations = new Map();\r\n    this.trends = new Map();\r\n  }\r\n\r\n  /**\r\n   * Add metric to aggregation\r\n   */\r\n  addMetric(metric) {\r\n    this.metrics.push(metric);\r\n    this.updateAggregations(metric);\r\n    this.updateTrends(metric);\r\n  }\r\n\r\n  /**\r\n   * Update aggregations for metric\r\n   */\r\n  updateAggregations(metric) {\r\n    const key = metric.indicator;\r\n\r\n    if (!this.aggregations.has(key)) {\r\n      this.aggregations.set(key, {\r\n        count: 0,\r\n        sum: 0,\r\n        min: Infinity,\r\n        max: -Infinity,\r\n        values: [],\r\n      });\r\n    }\r\n\r\n    const agg = this.aggregations.get(key);\r\n    agg.count++;\r\n    agg.sum += metric.value;\r\n    agg.min = Math.min(agg.min, metric.value);\r\n    agg.max = Math.max(agg.max, metric.value);\r\n    agg.values.push({ value: metric.value, timestamp: metric.timestamp });\r\n\r\n    // Keep only last 100 values for performance\r\n    if (agg.values.length > 100) {\r\n      agg.values.shift();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update trends for metric\r\n   */\r\n  updateTrends(metric) {\r\n    const key = metric.indicator;\r\n    const now = new Date();\r\n    const timeKey = `${now.getFullYear()}-${now.getMonth() + 1}-${now.getDate()}`;\r\n\r\n    if (!this.trends.has(key)) {\r\n      this.trends.set(key, new Map());\r\n    }\r\n\r\n    const metricTrends = this.trends.get(key);\r\n\r\n    if (!metricTrends.has(timeKey)) {\r\n      metricTrends.set(timeKey, {\r\n        date: timeKey,\r\n        values: [],\r\n        average: 0,\r\n        count: 0,\r\n      });\r\n    }\r\n\r\n    const dayTrend = metricTrends.get(timeKey);\r\n    dayTrend.values.push(metric.value);\r\n    dayTrend.count++;\r\n    dayTrend.average = dayTrend.values.reduce((sum, val) => sum + val, 0) / dayTrend.count;\r\n  }\r\n\r\n  /**\r\n   * Get aggregated statistics\r\n   */\r\n  getAggregatedStats(indicator) {\r\n    const agg = this.aggregations.get(indicator);\r\n    if (!agg) {\r\n      return null;\r\n    }\r\n\r\n    return {\r\n      indicator,\r\n      count: agg.count,\r\n      average: agg.sum / agg.count,\r\n      min: agg.min,\r\n      max: agg.max,\r\n      median: this.calculateMedian(agg.values.map((v) => v.value)),\r\n      standardDeviation: this.calculateStandardDeviation(agg.values.map((v) => v.value)),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get trend data\r\n   */\r\n  getTrendData(indicator, days = 30) {\r\n    const metricTrends = this.trends.get(indicator);\r\n    if (!metricTrends) {\r\n      return null;\r\n    }\r\n\r\n    const now = new Date();\r\n    const trends = [];\r\n\r\n    for (let i = days - 1; i >= 0; i--) {\r\n      const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);\r\n      const timeKey = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;\r\n\r\n      if (metricTrends.has(timeKey)) {\r\n        trends.push(metricTrends.get(timeKey));\r\n      } else {\r\n        trends.push({\r\n          date: timeKey,\r\n          values: [],\r\n          average: null,\r\n          count: 0,\r\n        });\r\n      }\r\n    }\r\n\r\n    return trends;\r\n  }\r\n\r\n  /**\r\n   * Calculate median\r\n   */\r\n  calculateMedian(values) {\r\n    const sorted = [...values].sort((a, b) => a - b);\r\n    const mid = Math.floor(sorted.length / 2);\r\n\r\n    return sorted.length % 2 !== 0\r\n      ? sorted[mid]\r\n      : (sorted[mid - 1] + sorted[mid]) / 2;\r\n  }\r\n\r\n  /**\r\n   * Calculate standard deviation\r\n   */\r\n  calculateStandardDeviation(values) {\r\n    const mean = values.reduce((sum, val) => sum + val, 0) / values.length;\r\n    const squaredDiffs = values.map((val) => (val - mean) ** 2);\r\n    const avgSquaredDiff = squaredDiffs.reduce((sum, val) => sum + val, 0) / values.length;\r\n\r\n    return Math.sqrt(avgSquaredDiff);\r\n  }\r\n}\r\n\r\n/**\r\n * Quality dashboard generator\r\n */\r\nclass QualityDashboard {\r\n  constructor(aggregator) {\r\n    this.aggregator = aggregator;\r\n  }\r\n\r\n  /**\r\n   * Generate dashboard data\r\n   */\r\n  generateDashboard() {\r\n    const indicators = Object.values(ClinicalIndicators);\r\n    const dashboard = {\r\n      overview: this.generateOverview(),\r\n      indicators: [],\r\n      trends: [],\r\n      alerts: [],\r\n    };\r\n\r\n    // Generate indicator summaries\r\n    indicators.forEach((indicator) => {\r\n      const stats = this.aggregator.getAggregatedStats(indicator);\r\n      const trends = this.aggregator.getTrendData(indicator, 7); // Last 7 days\r\n\r\n      if (stats) {\r\n        const indicatorData = {\r\n          indicator,\r\n          name: this.getIndicatorName(indicator),\r\n          category: this.getIndicatorCategory(indicator),\r\n          current: stats.average,\r\n          benchmark: QualityBenchmarks[indicator],\r\n          performance: this.calculateIndicatorPerformance(stats.average, indicator),\r\n          trend: this.calculateTrendDirection(trends),\r\n          stats,\r\n        };\r\n\r\n        dashboard.indicators.push(indicatorData);\r\n\r\n        // Check for quality alerts\r\n        const alert = this.checkQualityAlert(indicatorData);\r\n        if (alert) {\r\n          dashboard.alerts.push(alert);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Generate trend summaries\r\n    dashboard.trends = this.generateTrendSummaries();\r\n\r\n    return dashboard;\r\n  }\r\n\r\n  /**\r\n   * Generate overview metrics\r\n   */\r\n  generateOverview() {\r\n    const allMetrics = this.aggregator.metrics;\r\n    const last24Hours = allMetrics.filter((m) => new Date(m.timestamp) > new Date(Date.now() - 24 * 60 * 60 * 1000));\r\n\r\n    const performanceScores = allMetrics\r\n      .filter((m) => m.performance.score !== null)\r\n      .map((m) => m.performance.score);\r\n\r\n    const avgPerformance = performanceScores.length > 0\r\n      ? performanceScores.reduce((sum, score) => sum + score, 0) / performanceScores.length\r\n      : 0;\r\n\r\n    return {\r\n      totalMetrics: allMetrics.length,\r\n      metricsLast24h: last24Hours.length,\r\n      averagePerformance: Math.round(avgPerformance),\r\n      qualityLevel: this.getQualityLevel(avgPerformance),\r\n      lastUpdated: new Date().toISOString(),\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get indicator name\r\n   */\r\n  getIndicatorName(indicator) {\r\n    const names = {\r\n      [ClinicalIndicators.DOOR_TO_NEEDLE_TIME]: 'Door-to-Needle Time',\r\n      [ClinicalIndicators.DOOR_TO_IMAGING_TIME]: 'Door-to-Imaging Time',\r\n      [ClinicalIndicators.IMAGING_TO_DECISION_TIME]: 'Imaging-to-Decision Time',\r\n      [ClinicalIndicators.MORTALITY_RATE_30D]: '30-Day Mortality Rate',\r\n      [ClinicalIndicators.FUNCTIONAL_INDEPENDENCE_90D]: '90-Day Functional Independence',\r\n      [ClinicalIndicators.HEMORRHAGIC_TRANSFORMATION_RATE]: 'Hemorrhagic Transformation Rate',\r\n      [ClinicalIndicators.THROMBOLYSIS_RATE]: 'Thrombolysis Rate',\r\n      [ClinicalIndicators.MECHANICAL_THROMBECTOMY_RATE]: 'Mechanical Thrombectomy Rate',\r\n      [ClinicalIndicators.PREDICTION_ACCURACY]: 'Prediction Accuracy',\r\n      [ClinicalIndicators.MODEL_CALIBRATION]: 'Model Calibration',\r\n      [ClinicalIndicators.ALERT_APPROPRIATENESS]: 'Alert Appropriateness',\r\n      [ClinicalIndicators.GUIDELINE_ADHERENCE]: 'Guideline Adherence',\r\n    };\r\n\r\n    return names[indicator] || indicator.replace(/_/g, ' ').replace(/\\b\\w/g, (l) => l.toUpperCase());\r\n  }\r\n\r\n  /**\r\n   * Get indicator category\r\n   */\r\n  getIndicatorCategory(indicator) {\r\n    const categories = {\r\n      [ClinicalIndicators.DOOR_TO_NEEDLE_TIME]: QualityCategories.PROCESS,\r\n      [ClinicalIndicators.DOOR_TO_IMAGING_TIME]: QualityCategories.PROCESS,\r\n      [ClinicalIndicators.IMAGING_TO_DECISION_TIME]: QualityCategories.EFFICIENCY,\r\n      [ClinicalIndicators.MORTALITY_RATE_30D]: QualityCategories.OUTCOME,\r\n      [ClinicalIndicators.FUNCTIONAL_INDEPENDENCE_90D]: QualityCategories.OUTCOME,\r\n      [ClinicalIndicators.HEMORRHAGIC_TRANSFORMATION_RATE]: QualityCategories.SAFETY,\r\n      [ClinicalIndicators.THROMBOLYSIS_RATE]: QualityCategories.PROCESS,\r\n      [ClinicalIndicators.MECHANICAL_THROMBECTOMY_RATE]: QualityCategories.PROCESS,\r\n      [ClinicalIndicators.PREDICTION_ACCURACY]: QualityCategories.EFFICIENCY,\r\n      [ClinicalIndicators.MODEL_CALIBRATION]: QualityCategories.EFFICIENCY,\r\n      [ClinicalIndicators.ALERT_APPROPRIATENESS]: QualityCategories.EFFICIENCY,\r\n      [ClinicalIndicators.GUIDELINE_ADHERENCE]: QualityCategories.PROCESS,\r\n    };\r\n\r\n    return categories[indicator] || QualityCategories.PROCESS;\r\n  }\r\n\r\n  /**\r\n   * Calculate indicator performance\r\n   */\r\n  calculateIndicatorPerformance(value, indicator) {\r\n    const metric = new QualityMetric(indicator, null, value, new Date().toISOString());\r\n    return metric.performance;\r\n  }\r\n\r\n  /**\r\n   * Calculate trend direction\r\n   */\r\n  calculateTrendDirection(trends) {\r\n    if (!trends || trends.length < 2) {\r\n      return { direction: 'stable', change: 0 };\r\n    }\r\n\r\n    const validTrends = trends.filter((t) => t.average !== null);\r\n    if (validTrends.length < 2) {\r\n      return { direction: 'stable', change: 0 };\r\n    }\r\n\r\n    const recent = validTrends[validTrends.length - 1].average;\r\n    const previous = validTrends[validTrends.length - 2].average;\r\n    const change = ((recent - previous) / previous) * 100;\r\n\r\n    let direction;\r\n    if (Math.abs(change) < 5) {\r\n      direction = 'stable';\r\n    } else if (change > 0) {\r\n      direction = 'improving';\r\n    } else {\r\n      direction = 'declining';\r\n    }\r\n\r\n    return { direction, change: Math.round(change * 10) / 10 };\r\n  }\r\n\r\n  /**\r\n   * Check for quality alerts\r\n   */\r\n  checkQualityAlert(indicatorData) {\r\n    const { performance, trend, indicator } = indicatorData;\r\n\r\n    // Performance-based alerts\r\n    if (performance.level === 'needs_improvement') {\r\n      return {\r\n        type: 'performance',\r\n        severity: 'high',\r\n        indicator,\r\n        message: `${indicatorData.name} performance is below acceptable threshold`,\r\n        recommendation: 'Review processes and implement improvement measures',\r\n      };\r\n    }\r\n\r\n    // Trend-based alerts\r\n    if (trend.direction === 'declining' && Math.abs(trend.change) > 15) {\r\n      return {\r\n        type: 'trend',\r\n        severity: 'medium',\r\n        indicator,\r\n        message: `${indicatorData.name} showing declining trend (${trend.change}%)`,\r\n        recommendation: 'Monitor closely and identify contributing factors',\r\n      };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  /**\r\n   * Generate trend summaries\r\n   */\r\n  generateTrendSummaries() {\r\n    const summaries = [];\r\n    const indicators = Object.values(ClinicalIndicators);\r\n\r\n    indicators.forEach((indicator) => {\r\n      const trends = this.aggregator.getTrendData(indicator, 30);\r\n      if (trends) {\r\n        const summary = this.analyzeTrend(indicator, trends);\r\n        if (summary) {\r\n          summaries.push(summary);\r\n        }\r\n      }\r\n    });\r\n\r\n    return summaries.sort((a, b) => b.significance - a.significance);\r\n  }\r\n\r\n  /**\r\n   * Analyze trend for significance\r\n   */\r\n  analyzeTrend(indicator, trends) {\r\n    const validTrends = trends.filter((t) => t.average !== null);\r\n    if (validTrends.length < 7) {\r\n      return null;\r\n    }\r\n\r\n    // Calculate linear regression for trend analysis\r\n    const points = validTrends.map((t, i) => ({ x: i, y: t.average }));\r\n    const regression = this.calculateLinearRegression(points);\r\n\r\n    const significance = Math.abs(regression.slope) * validTrends.length;\r\n\r\n    return {\r\n      indicator,\r\n      name: this.getIndicatorName(indicator),\r\n      slope: regression.slope,\r\n      correlation: regression.correlation,\r\n      significance,\r\n      trend: regression.slope > 0 ? 'improving' : regression.slope < 0 ? 'declining' : 'stable',\r\n      dataPoints: validTrends.length,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Calculate linear regression\r\n   */\r\n  calculateLinearRegression(points) {\r\n    const n = points.length;\r\n    const sumX = points.reduce((sum, p) => sum + p.x, 0);\r\n    const sumY = points.reduce((sum, p) => sum + p.y, 0);\r\n    const sumXY = points.reduce((sum, p) => sum + p.x * p.y, 0);\r\n    const sumXX = points.reduce((sum, p) => sum + p.x * p.x, 0);\r\n    const sumYY = points.reduce((sum, p) => sum + p.y * p.y, 0);\r\n\r\n    const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);\r\n    const intercept = (sumY - slope * sumX) / n;\r\n\r\n    // Calculate correlation coefficient\r\n    const numerator = n * sumXY - sumX * sumY;\r\n    const denominator = Math.sqrt((n * sumXX - sumX * sumX) * (n * sumYY - sumY * sumY));\r\n    const correlation = denominator !== 0 ? numerator / denominator : 0;\r\n\r\n    return { slope, intercept, correlation };\r\n  }\r\n\r\n  /**\r\n   * Get quality level\r\n   */\r\n  getQualityLevel(score) {\r\n    if (score >= 90) {\r\n      return 'excellent';\r\n    }\r\n    if (score >= 85) {\r\n      return 'good';\r\n    }\r\n    if (score >= 70) {\r\n      return 'acceptable';\r\n    }\r\n    return 'needs_improvement';\r\n  }\r\n}\r\n\r\n/**\r\n * Quality Metrics Tracking System\r\n */\r\nexport class QualityMetricsTracker {\r\n  constructor() {\r\n    this.aggregator = new QualityAggregator();\r\n    this.dashboard = new QualityDashboard(this.aggregator);\r\n    this.collectors = new Map();\r\n    this.isActive = false;\r\n    this.updateInterval = null;\r\n  }\r\n\r\n  /**\r\n   * Initialize quality metrics tracking\r\n   */\r\n  async initialize() {\r\n    const metricId = medicalPerformanceMonitor.startMeasurement(\r\n      PerformanceMetricType.SYSTEM_STARTUP,\r\n      'quality_metrics_init',\r\n    );\r\n\r\n    try {\r\n      // Register metric collectors\r\n      this.registerMetricCollectors();\r\n\r\n      // Setup event listeners\r\n      this.setupEventListeners();\r\n\r\n      // Start periodic collection\r\n      this.startPeriodicCollection();\r\n\r\n      this.isActive = true;\r\n\r\n      medicalPerformanceMonitor.endMeasurement(metricId, { success: true });\r\n\r\n      medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\r\n        action: 'quality_metrics_tracker_initialized',\r\n        collectors: Array.from(this.collectors.keys()),\r\n      });\r\n    } catch (error) {\r\n      medicalPerformanceMonitor.endMeasurement(metricId, {\r\n        success: false,\r\n        error: error.message,\r\n      });\r\n\r\n      // ('Quality metrics tracker initialization failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Register metric collectors\r\n   */\r\n  registerMetricCollectors() {\r\n    // Process time collectors\r\n    this.collectors.set('door_to_needle_collector', {\r\n      indicator: ClinicalIndicators.DOOR_TO_NEEDLE_TIME,\r\n      category: QualityCategories.PROCESS,\r\n      collect: this.collectDoorToNeedleTime.bind(this),\r\n    });\r\n\r\n    this.collectors.set('door_to_imaging_collector', {\r\n      indicator: ClinicalIndicators.DOOR_TO_IMAGING_TIME,\r\n      category: QualityCategories.PROCESS,\r\n      collect: this.collectDoorToImagingTime.bind(this),\r\n    });\r\n\r\n    // Outcome collectors\r\n    this.collectors.set('prediction_accuracy_collector', {\r\n      indicator: ClinicalIndicators.PREDICTION_ACCURACY,\r\n      category: QualityCategories.EFFICIENCY,\r\n      collect: this.collectPredictionAccuracy.bind(this),\r\n    });\r\n\r\n    this.collectors.set('alert_appropriateness_collector', {\r\n      indicator: ClinicalIndicators.ALERT_APPROPRIATENESS,\r\n      category: QualityCategories.EFFICIENCY,\r\n      collect: this.collectAlertAppropriateness.bind(this),\r\n    });\r\n\r\n    // Treatment rate collectors\r\n    this.collectors.set('thrombolysis_rate_collector', {\r\n      indicator: ClinicalIndicators.THROMBOLYSIS_RATE,\r\n      category: QualityCategories.PROCESS,\r\n      collect: this.collectThrombolysisRate.bind(this),\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Setup event listeners for real-time collection\r\n   */\r\n  setupEventListeners() {\r\n    // Listen for clinical events\r\n    medicalEventObserver.subscribe(MEDICAL_EVENTS.CLINICAL_ALERT, (data) => {\r\n      this.handleClinicalAlert(data);\r\n    });\r\n\r\n    medicalEventObserver.subscribe(MEDICAL_EVENTS.PREDICTION_GENERATED, (data) => {\r\n      this.handlePredictionGenerated(data);\r\n    });\r\n\r\n    medicalEventObserver.subscribe(MEDICAL_EVENTS.TREATMENT_DELIVERED, (data) => {\r\n      this.handleTreatmentDelivered(data);\r\n    });\r\n\r\n    medicalEventObserver.subscribe(MEDICAL_EVENTS.PATIENT_OUTCOME, (data) => {\r\n      this.handlePatientOutcome(data);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Start periodic metric collection\r\n   */\r\n  startPeriodicCollection() {\r\n    // Collect metrics every 15 minutes\r\n    this.updateInterval = setInterval(() => {\r\n      this.collectAllMetrics();\r\n    }, 15 * 60 * 1000);\r\n\r\n    // Initial collection\r\n    this.collectAllMetrics();\r\n  }\r\n\r\n  /**\r\n   * Collect all metrics from registered collectors\r\n   */\r\n  async collectAllMetrics() {\r\n    const metricId = medicalPerformanceMonitor.startMeasurement(\r\n      PerformanceMetricType.DATA_PROCESSING,\r\n      'collect_all_metrics',\r\n    );\r\n\r\n    try {\r\n      const collectionPromises = Array.from(this.collectors.values()).map(async (collector) => {\r\n        try {\r\n          const value = await collector.collect();\r\n          if (value !== null && value !== undefined) {\r\n            const metric = new QualityMetric(\r\n              collector.indicator,\r\n              collector.category,\r\n              value,\r\n              new Date().toISOString(),\r\n            );\r\n            this.aggregator.addMetric(metric);\r\n            return { indicator: collector.indicator, value, success: true };\r\n          }\r\n        } catch (error) {\r\n          // (`Failed to collect metric ${collector.indicator}:`, error);\r\n          return { indicator: collector.indicator, error: error.message, success: false };\r\n        }\r\n        return null;\r\n      });\r\n\r\n      const results = await Promise.allSettled(collectionPromises);\r\n      const successful = results.filter((r) => r.status === 'fulfilled' && r.value?.success);\r\n\r\n      medicalPerformanceMonitor.endMeasurement(metricId, {\r\n        success: true,\r\n        metricsCollected: successful.length,\r\n      });\r\n    } catch (error) {\r\n      medicalPerformanceMonitor.endMeasurement(metricId, {\r\n        success: false,\r\n        error: error.message,\r\n      });\r\n\r\n      // ('Metric collection failed:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Record custom metric\r\n   */\r\n  recordMetric(indicator, category, value, metadata = {}) {\r\n    const metric = new QualityMetric(\r\n      indicator,\r\n      category,\r\n      value,\r\n      new Date().toISOString(),\r\n      metadata,\r\n    );\r\n\r\n    this.aggregator.addMetric(metric);\r\n\r\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\r\n      action: 'quality_metric_recorded',\r\n      indicator,\r\n      value,\r\n      performance: metric.performance,\r\n    });\r\n\r\n    return metric;\r\n  }\r\n\r\n  /**\r\n   * Get quality dashboard\r\n   */\r\n  getQualityDashboard() {\r\n    return this.dashboard.generateDashboard();\r\n  }\r\n\r\n  /**\r\n   * Get metric statistics\r\n   */\r\n  getMetricStatistics(indicator) {\r\n    return this.aggregator.getAggregatedStats(indicator);\r\n  }\r\n\r\n  /**\r\n   * Get trend data\r\n   */\r\n  getTrendData(indicator, days = 30) {\r\n    return this.aggregator.getTrendData(indicator, days);\r\n  }\r\n\r\n  /**\r\n   * Export quality report\r\n   */\r\n  exportQualityReport(format = 'json') {\r\n    const dashboard = this.getQualityDashboard();\r\n    const report = {\r\n      timestamp: new Date().toISOString(),\r\n      version: '1.0',\r\n      dashboard,\r\n      detailedMetrics: this.getDetailedMetrics(),\r\n    };\r\n\r\n    switch (format) {\r\n      case 'json':\r\n        return JSON.stringify(report, null, 2);\r\n      case 'csv':\r\n        return this.convertToCSV(report);\r\n      default:\r\n        return report;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get detailed metrics\r\n   */\r\n  getDetailedMetrics() {\r\n    const indicators = Object.values(ClinicalIndicators);\r\n    const detailed = {};\r\n\r\n    indicators.forEach((indicator) => {\r\n      const stats = this.aggregator.getAggregatedStats(indicator);\r\n      const trends = this.aggregator.getTrendData(indicator, 30);\r\n\r\n      if (stats) {\r\n        detailed[indicator] = {\r\n          statistics: stats,\r\n          trends,\r\n          benchmark: QualityBenchmarks[indicator],\r\n        };\r\n      }\r\n    });\r\n\r\n    return detailed;\r\n  }\r\n\r\n  /**\r\n   * Specific metric collectors\r\n   */\r\n  async collectDoorToNeedleTime() {\r\n    // Simulate collecting door-to-needle times from system\r\n    // In real implementation, this would query database or system logs\r\n    return Math.random() * 40 + 30; // 30-70 minutes\r\n  }\r\n\r\n  async collectDoorToImagingTime() {\r\n    // Simulate collecting door-to-imaging times\r\n    return Math.random() * 20 + 15; // 15-35 minutes\r\n  }\r\n\r\n  async collectPredictionAccuracy() {\r\n    // Simulate prediction accuracy from model validation\r\n    return Math.random() * 20 + 80; // 80-100%\r\n  }\r\n\r\n  async collectAlertAppropriateness() {\r\n    // Simulate alert appropriateness metric\r\n    return Math.random() * 30 + 70; // 70-100%\r\n  }\r\n\r\n  async collectThrombolysisRate() {\r\n    // Simulate thrombolysis rate\r\n    return Math.random() * 15 + 10; // 10-25%\r\n  }\r\n\r\n  /**\r\n   * Event handlers for real-time metrics\r\n   */\r\n  handleClinicalAlert(data) {\r\n    // Increment alert count for appropriateness tracking\r\n    const isAppropriate = this.assessAlertAppropriateness(data.alert);\r\n\r\n    this.recordMetric(\r\n      ClinicalIndicators.ALERT_APPROPRIATENESS,\r\n      QualityCategories.EFFICIENCY,\r\n      isAppropriate ? 100 : 0,\r\n      { alertId: data.alert.id, alertType: data.alert.ruleId },\r\n    );\r\n  }\r\n\r\n  handlePredictionGenerated(data) {\r\n    // Track prediction generation for quality monitoring\r\n    const confidence = data.predictions?.mortality?.confidence?.percent || 0;\r\n\r\n    this.recordMetric(\r\n      'prediction_confidence',\r\n      QualityCategories.EFFICIENCY,\r\n      confidence,\r\n      { patientId: data.patientId },\r\n    );\r\n  }\r\n\r\n  handleTreatmentDelivered(data) {\r\n    // Track treatment delivery times and rates\r\n    if (data.treatment === 'thrombolysis') {\r\n      const { doorToNeedleTime } = data;\r\n      if (doorToNeedleTime) {\r\n        this.recordMetric(\r\n          ClinicalIndicators.DOOR_TO_NEEDLE_TIME,\r\n          QualityCategories.PROCESS,\r\n          doorToNeedleTime,\r\n          { patientId: data.patientId },\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  handlePatientOutcome(data) {\r\n    // Track patient outcomes for quality assessment\r\n    if (data.outcome === 'mortality_30d') {\r\n      this.recordMetric(\r\n        ClinicalIndicators.MORTALITY_RATE_30D,\r\n        QualityCategories.OUTCOME,\r\n        data.value ? 100 : 0, // Convert boolean to percentage point\r\n        { patientId: data.patientId },\r\n      );\r\n    }\r\n\r\n    if (data.outcome === 'functional_independence_90d') {\r\n      this.recordMetric(\r\n        ClinicalIndicators.FUNCTIONAL_INDEPENDENCE_90D,\r\n        QualityCategories.OUTCOME,\r\n        data.value ? 100 : 0,\r\n        { patientId: data.patientId },\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Assess alert appropriateness\r\n   */\r\n  assessAlertAppropriateness(alert) {\r\n    // Simplified appropriateness assessment\r\n    // In real implementation, this would be more sophisticated\r\n\r\n    if (alert.severity?.level === 'critical') {\r\n      return Math.random() > 0.1; // 90% appropriate for critical alerts\r\n    } if (alert.severity?.level === 'high') {\r\n      return Math.random() > 0.2; // 80% appropriate for high alerts\r\n    }\r\n    return Math.random() > 0.3; // 70% appropriate for other alerts\r\n  }\r\n\r\n  /**\r\n   * Convert report to CSV format\r\n   */\r\n  convertToCSV(report) {\r\n    const rows = [\r\n      ['Indicator', 'Category', 'Current Value', 'Benchmark Target', 'Performance Level', 'Trend Direction'],\r\n    ];\r\n\r\n    report.dashboard.indicators.forEach((indicator) => {\r\n      rows.push([\r\n        indicator.name,\r\n        indicator.category,\r\n        indicator.current?.toFixed(2) || 'N/A',\r\n        indicator.benchmark?.target || 'N/A',\r\n        indicator.performance?.level || 'N/A',\r\n        indicator.trend?.direction || 'N/A',\r\n      ]);\r\n    });\r\n\r\n    return rows.map((row) => row.join(',')).join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Get quality trends summary\r\n   */\r\n  getQualityTrendsSummary(days = 30) {\r\n    const summary = {\r\n      period: `${days} days`,\r\n      overallTrend: 'stable',\r\n      improvingIndicators: [],\r\n      decliningIndicators: [],\r\n      stableIndicators: [],\r\n    };\r\n\r\n    const indicators = Object.values(ClinicalIndicators);\r\n\r\n    indicators.forEach((indicator) => {\r\n      const trends = this.aggregator.getTrendData(indicator, days);\r\n      if (trends) {\r\n        const trendDirection = this.dashboard.calculateTrendDirection(trends);\r\n\r\n        const indicatorSummary = {\r\n          indicator,\r\n          name: this.dashboard.getIndicatorName(indicator),\r\n          direction: trendDirection.direction,\r\n          change: trendDirection.change,\r\n        };\r\n\r\n        if (trendDirection.direction === 'improving') {\r\n          summary.improvingIndicators.push(indicatorSummary);\r\n        } else if (trendDirection.direction === 'declining') {\r\n          summary.decliningIndicators.push(indicatorSummary);\r\n        } else {\r\n          summary.stableIndicators.push(indicatorSummary);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Determine overall trend\r\n    if (summary.improvingIndicators.length > summary.decliningIndicators.length) {\r\n      summary.overallTrend = 'improving';\r\n    } else if (summary.decliningIndicators.length > summary.improvingIndicators.length) {\r\n      summary.overallTrend = 'declining';\r\n    }\r\n\r\n    return summary;\r\n  }\r\n\r\n  /**\r\n   * Stop quality metrics tracking\r\n   */\r\n  stop() {\r\n    if (this.updateInterval) {\r\n      clearInterval(this.updateInterval);\r\n      this.updateInterval = null;\r\n    }\r\n\r\n    this.isActive = false;\r\n\r\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\r\n      action: 'quality_metrics_tracker_stopped',\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Dispose quality metrics tracker\r\n   */\r\n  dispose() {\r\n    this.stop();\r\n    this.collectors.clear();\r\n    this.aggregator.metrics.length = 0;\r\n    this.aggregator.aggregations.clear();\r\n    this.aggregator.trends.clear();\r\n\r\n    medicalEventObserver.publish(MEDICAL_EVENTS.AUDIT_EVENT, {\r\n      action: 'quality_metrics_tracker_disposed',\r\n    });\r\n  }\r\n}\r\n\r\n// Export quality metrics tracker instance\r\nexport const qualityMetricsTracker = new QualityMetricsTracker();\r\n","/**\r\n * Clinical Audit Trail System\r\n * iGFAP Stroke Triage Assistant - Phase 4 Medical Intelligence\r\n *\r\n * Comprehensive audit logging and compliance tracking for clinical decisions\r\n */\r\n\r\nimport { medicalEventObserver, MEDICAL_EVENTS } from '../patterns/observer.js';\r\nimport { medicalPerformanceMonitor, PerformanceMetricType } from '../performance/medical-performance-monitor.js';\r\nimport { predictionCache } from '../performance/medical-cache.js';\r\n\r\n/**\r\n * Audit event types\r\n */\r\nexport const AuditEventTypes = {\r\n  USER_LOGIN: 'user_login',\r\n  USER_LOGOUT: 'user_logout',\r\n  PATIENT_ACCESS: 'patient_access',\r\n  DATA_ENTRY: 'data_entry',\r\n  DATA_MODIFICATION: 'data_modification',\r\n  PREDICTION_GENERATED: 'prediction_generated',\r\n  ALERT_TRIGGERED: 'alert_triggered',\r\n  ALERT_ACKNOWLEDGED: 'alert_acknowledged',\r\n  TREATMENT_RECOMMENDED: 'treatment_recommended',\r\n  REPORT_GENERATED: 'report_generated',\r\n  DATA_EXPORT: 'data_export',\r\n  SYSTEM_ERROR: 'system_error',\r\n  CONFIGURATION_CHANGE: 'configuration_change',\r\n  MODEL_PREDICTION: 'model_prediction',\r\n  QUALITY_METRIC: 'quality_metric',\r\n  CLINICAL_DECISION: 'clinical_decision',\r\n};\r\n\r\n/**\r\n * Audit severity levels\r\n */\r\nexport const AuditSeverity = {\r\n  INFO: 'info',\r\n  WARNING: 'warning',\r\n  ERROR: 'error',\r\n  CRITICAL: 'critical',\r\n};\r\n\r\n/**\r\n * Compliance frameworks\r\n */\r\nexport const ComplianceFrameworks = {\r\n  HIPAA: 'hipaa',\r\n  GDPR: 'gdpr',\r\n  FDA_21CFR11: 'fda_21cfr11',\r\n  IEC_62304: 'iec_62304',\r\n  ISO_27001: 'iso_27001',\r\n};\r\n\r\n/**\r\n * Audit event data structure\r\n */\r\nclass AuditEvent {\r\n  constructor(eventType, data = {}) {\r\n    this.id = `audit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\r\n    this.timestamp = new Date().toISOString();\r\n    this.eventType = eventType;\r\n    this.severity = data.severity || AuditSeverity.INFO;\r\n    this.userId = data.userId || 'system';\r\n    this.sessionId = data.sessionId || null;\r\n    this.patientId = data.patientId || null;\r\n    this.ipAddress = data.ipAddress || this.getClientIP();\r\n    this.userAgent = data.userAgent || navigator.userAgent;\r\n    this.module = data.module || null;\r\n    this.action = data.action || null;\r\n    this.resource = data.resource || null;\r\n    this.oldValue = data.oldValue || null;\r\n    this.newValue = data.newValue || null;\r\n    this.outcome = data.outcome || 'success';\r\n    this.errorMessage = data.errorMessage || null;\r\n    this.metadata = data.metadata || {};\r\n    this.compliance = this.determineComplianceRequirements(eventType);\r\n    this.hash = this.calculateHash();\r\n  }\r\n\r\n  /**\r\n   * Get client IP address (simplified)\r\n   */\r\n  getClientIP() {\r\n    // In real implementation, this would get actual client IP\r\n    return '127.0.0.1';\r\n  }\r\n\r\n  /**\r\n   * Determine compliance requirements for event type\r\n   */\r\n  determineComplianceRequirements(eventType) {\r\n    const requirements = [];\r\n\r\n    // HIPAA requirements for PHI access and modifications\r\n    if ([\r\n      AuditEventTypes.PATIENT_ACCESS,\r\n      AuditEventTypes.DATA_ENTRY,\r\n      AuditEventTypes.DATA_MODIFICATION,\r\n      AuditEventTypes.DATA_EXPORT,\r\n      AuditEventTypes.REPORT_GENERATED,\r\n    ].includes(eventType)) {\r\n      requirements.push(ComplianceFrameworks.HIPAA);\r\n    }\r\n\r\n    // FDA 21 CFR Part 11 for electronic records\r\n    if ([\r\n      AuditEventTypes.DATA_ENTRY,\r\n      AuditEventTypes.DATA_MODIFICATION,\r\n      AuditEventTypes.REPORT_GENERATED,\r\n      AuditEventTypes.CLINICAL_DECISION,\r\n    ].includes(eventType)) {\r\n      requirements.push(ComplianceFrameworks.FDA_21CFR11);\r\n    }\r\n\r\n    // IEC 62304 for medical device software\r\n    if ([\r\n      AuditEventTypes.PREDICTION_GENERATED,\r\n      AuditEventTypes.MODEL_PREDICTION,\r\n      AuditEventTypes.SYSTEM_ERROR,\r\n      AuditEventTypes.CONFIGURATION_CHANGE,\r\n    ].includes(eventType)) {\r\n      requirements.push(ComplianceFrameworks.IEC_62304);\r\n    }\r\n\r\n    return requirements;\r\n  }\r\n\r\n  /**\r\n   * Calculate event hash for integrity verification\r\n   */\r\n  calculateHash() {\r\n    const dataString = JSON.stringify({\r\n      timestamp: this.timestamp,\r\n      eventType: this.eventType,\r\n      userId: this.userId,\r\n      action: this.action,\r\n      resource: this.resource,\r\n      outcome: this.outcome,\r\n    });\r\n\r\n    // Simplified hash calculation - in real implementation use crypto.subtle\r\n    let hash = 0;\r\n    for (let i = 0; i < dataString.length; i++) {\r\n      const char = dataString.charCodeAt(i);\r\n      hash = ((hash << 5) - hash) + char;\r\n      hash &= hash; // Convert to 32-bit integer\r\n    }\r\n\r\n    return Math.abs(hash).toString(16);\r\n  }\r\n\r\n  /**\r\n   * Sanitize event for storage (remove sensitive data)\r\n   */\r\n  sanitize() {\r\n    const sanitized = { ...this };\r\n\r\n    // Remove or hash sensitive information\r\n    if (sanitized.patientId) {\r\n      sanitized.patientId = this.hashSensitiveData(sanitized.patientId);\r\n    }\r\n\r\n    if (sanitized.oldValue && typeof sanitized.oldValue === 'object') {\r\n      sanitized.oldValue = this.sanitizeObject(sanitized.oldValue);\r\n    }\r\n\r\n    if (sanitized.newValue && typeof sanitized.newValue === 'object') {\r\n      sanitized.newValue = this.sanitizeObject(sanitized.newValue);\r\n    }\r\n\r\n    return sanitized;\r\n  }\r\n\r\n  /**\r\n   * Hash sensitive data\r\n   */\r\n  hashSensitiveData(data) {\r\n    // In real implementation, use proper cryptographic hashing\r\n    return `hash_${data.toString().length}_${Date.now().toString(36)}`;\r\n  }\r\n\r\n  /**\r\n   * Sanitize object by removing PII\r\n   */\r\n  sanitizeObject(obj) {\r\n    const sanitized = { ...obj };\r\n    const sensitiveFields = ['name', 'ssn', 'address', 'phone', 'email'];\r\n\r\n    sensitiveFields.forEach((field) => {\r\n      if (sanitized[field]) {\r\n        sanitized[field] = '[REDACTED]';\r\n      }\r\n    });\r\n\r\n    return sanitized;\r\n  }\r\n\r\n  /**\r\n   * Export event in compliance format\r\n   */\r\n  exportForCompliance(framework) {\r\n    const baseExport = {\r\n      eventId: this.id,\r\n      timestamp: this.timestamp,\r\n      eventType: this.eventType,\r\n      userId: this.userId,\r\n      outcome: this.outcome,\r\n      hash: this.hash,\r\n    };\r\n\r\n    switch (framework) {\r\n      case ComplianceFrameworks.HIPAA:\r\n        return {\r\n          ...baseExport,\r\n          patientId: this.patientId ? '[PROTECTED]' : null,\r\n          accessType: this.action,\r\n          reasonForAccess: this.metadata.reason || 'Clinical care',\r\n          minimalNecessary: true,\r\n        };\r\n\r\n      case ComplianceFrameworks.FDA_21CFR11:\r\n        return {\r\n          ...baseExport,\r\n          electronicSignature: this.metadata.signature || null,\r\n          recordIntegrity: this.hash,\r\n          auditTrailComplete: true,\r\n          dataModification: {\r\n            old: this.oldValue ? '[RECORDED]' : null,\r\n            new: this.newValue ? '[RECORDED]' : null,\r\n          },\r\n        };\r\n\r\n      case ComplianceFrameworks.IEC_62304:\r\n        return {\r\n          ...baseExport,\r\n          softwareVersion: this.metadata.version || '1.0',\r\n          riskClass: this.metadata.riskClass || 'B',\r\n          safetyRequirement: this.metadata.safetyRequirement || null,\r\n          traceabilityId: this.metadata.traceabilityId || null,\r\n        };\r\n\r\n      default:\r\n        return baseExport;\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Audit trail storage and management\r\n */\r\nclass AuditStorage {\r\n  constructor() {\r\n    this.events = [];\r\n    this.indices = new Map();\r\n    this.maxEvents = 10000; // Maximum events to keep in memory\r\n    this.retentionPeriod = 7 * 365 * 24 * 60 * 60 * 1000; // 7 years in milliseconds\r\n  }\r\n\r\n  /**\r\n   * Store audit event\r\n   */\r\n  store(event) {\r\n    // Add to events array\r\n    this.events.push(event);\r\n\r\n    // Update indices for fast searching\r\n    this.updateIndices(event);\r\n\r\n    // Maintain size limits\r\n    this.maintainStorageSize();\r\n\r\n    // Trigger persistence\r\n    this.persistEvent(event);\r\n  }\r\n\r\n  /**\r\n   * Update search indices\r\n   */\r\n  updateIndices(event) {\r\n    // Index by event type\r\n    if (!this.indices.has('eventType')) {\r\n      this.indices.set('eventType', new Map());\r\n    }\r\n    const eventTypeIndex = this.indices.get('eventType');\r\n    if (!eventTypeIndex.has(event.eventType)) {\r\n      eventTypeIndex.set(event.eventType, []);\r\n    }\r\n    eventTypeIndex.get(event.eventType).push(event.id);\r\n\r\n    // Index by user ID\r\n    if (!this.indices.has('userId')) {\r\n      this.indices.set('userId', new Map());\r\n    }\r\n    const userIndex = this.indices.get('userId');\r\n    if (!userIndex.has(event.userId)) {\r\n      userIndex.set(event.userId, []);\r\n    }\r\n    userIndex.get(event.userId).push(event.id);\r\n\r\n    // Index by patient ID\r\n    if (event.patientId) {\r\n      if (!this.indices.has('patientId')) {\r\n        this.indices.set('patientId', new Map());\r\n      }\r\n      const patientIndex = this.indices.get('patientId');\r\n      if (!patientIndex.has(event.patientId)) {\r\n        patientIndex.set(event.patientId, []);\r\n      }\r\n      patientIndex.get(event.patientId).push(event.id);\r\n    }\r\n\r\n    // Index by date (day granularity)\r\n    const dateKey = event.timestamp.split('T')[0];\r\n    if (!this.indices.has('date')) {\r\n      this.indices.set('date', new Map());\r\n    }\r\n    const dateIndex = this.indices.get('date');\r\n    if (!dateIndex.has(dateKey)) {\r\n      dateIndex.set(dateKey, []);\r\n    }\r\n    dateIndex.get(dateKey).push(event.id);\r\n  }\r\n\r\n  /**\r\n   * Maintain storage size limits\r\n   */\r\n  maintainStorageSize() {\r\n    if (this.events.length > this.maxEvents) {\r\n      const eventsToRemove = this.events.length - this.maxEvents;\r\n      const removedEvents = this.events.splice(0, eventsToRemove);\r\n\r\n      // Update indices to remove old events\r\n      removedEvents.forEach((event) => {\r\n        this.removeFromIndices(event);\r\n      });\r\n    }\r\n\r\n    // Remove events older than retention period\r\n    const cutoffTime = new Date(Date.now() - this.retentionPeriod);\r\n    this.events = this.events.filter((event) => {\r\n      const eventTime = new Date(event.timestamp);\r\n      const shouldKeep = eventTime > cutoffTime;\r\n\r\n      if (!shouldKeep) {\r\n        this.removeFromIndices(event);\r\n      }\r\n\r\n      return shouldKeep;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Remove event from indices\r\n   */\r\n  removeFromIndices(event) {\r\n    // Remove from event type index\r\n    const eventTypeIndex = this.indices.get('eventType');\r\n    if (eventTypeIndex && eventTypeIndex.has(event.eventType)) {\r\n      const eventIds = eventTypeIndex.get(event.eventType);\r\n      const index = eventIds.indexOf(event.id);\r\n      if (index > -1) {\r\n        eventIds.splice(index, 1);\r\n      }\r\n    }\r\n\r\n    // Remove from user index\r\n    const userIndex = this.indices.get('userId');\r\n    if (userIndex && userIndex.has(event.userId)) {\r\n      const eventIds = userIndex.get(event.userId);\r\n      const index = eventIds.indexOf(event.id);\r\n      if (index > -1) {\r\n        eventIds.splice(index, 1);\r\n      }\r\n    }\r\n\r\n    // Remove from patient index\r\n    if (event.patientId) {\r\n      const patientIndex = this.indices.get('patientId');\r\n      if (patientIndex && patientIndex.has(event.patientId)) {\r\n        const eventIds = patientIndex.get(event.patientId);\r\n        const index = eventIds.indexOf(event.id);\r\n        if (index > -1) {\r\n          eventIds.splice(index, 1);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Remove from date index\r\n    const dateKey = event.timestamp.split('T')[0];\r\n    const dateIndex = this.indices.get('date');\r\n    if (dateIndex && dateIndex.has(dateKey)) {\r\n      const eventIds = dateIndex.get(dateKey);\r\n      const index = eventIds.indexOf(event.id);\r\n      if (index > -1) {\r\n        eventIds.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Persist event to secure storage\r\n   */\r\n  async persistEvent(event) {\r\n    try {\r\n      // In real implementation, this would persist to secure database\r\n      const sanitizedEvent = event.sanitize();\r\n      await predictionCache.set(`audit_${event.id}`, sanitizedEvent, 24 * 60 * 60 * 1000);\r\n    } catch (error) {\r\n      // ('Failed to persist audit event:', error);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Search events\r\n   */\r\n  search(criteria) {\r\n    let candidateIds = new Set();\r\n    let firstCriteria = true;\r\n\r\n    // Use indices to find candidate events\r\n    Object.entries(criteria).forEach(([key, value]) => {\r\n      const index = this.indices.get(key);\r\n      if (index && index.has(value)) {\r\n        const ids = new Set(index.get(value));\r\n\r\n        if (firstCriteria) {\r\n          candidateIds = ids;\r\n          firstCriteria = false;\r\n        } else {\r\n          // Intersection with previous results\r\n          candidateIds = new Set([...candidateIds].filter((id) => ids.has(id)));\r\n        }\r\n      } else if (firstCriteria) {\r\n        // If first criteria has no matches, return empty set\r\n        candidateIds = new Set();\r\n        firstCriteria = false;\r\n      } else {\r\n        // No intersection possible\r\n        candidateIds = new Set();\r\n      }\r\n    });\r\n\r\n    // Get actual events\r\n    const results = this.events.filter((event) => candidateIds.has(event.id));\r\n\r\n    // Apply additional filters\r\n    return this.applyAdditionalFilters(results, criteria);\r\n  }\r\n\r\n  /**\r\n   * Apply additional filters that can't use indices\r\n   */\r\n  applyAdditionalFilters(events, criteria) {\r\n    let filtered = events;\r\n\r\n    if (criteria.startDate) {\r\n      const startDate = new Date(criteria.startDate);\r\n      filtered = filtered.filter((event) => new Date(event.timestamp) >= startDate);\r\n    }\r\n\r\n    if (criteria.endDate) {\r\n      const endDate = new Date(criteria.endDate);\r\n      filtered = filtered.filter((event) => new Date(event.timestamp) <= endDate);\r\n    }\r\n\r\n    if (criteria.severity) {\r\n      filtered = filtered.filter((event) => event.severity === criteria.severity);\r\n    }\r\n\r\n    if (criteria.outcome) {\r\n      filtered = filtered.filter((event) => event.outcome === criteria.outcome);\r\n    }\r\n\r\n    if (criteria.textSearch) {\r\n      const searchTerm = criteria.textSearch.toLowerCase();\r\n      filtered = filtered.filter((event) => event.action?.toLowerCase().includes(searchTerm)\r\n        || event.resource?.toLowerCase().includes(searchTerm)\r\n        || event.errorMessage?.toLowerCase().includes(searchTerm));\r\n    }\r\n\r\n    return filtered.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));\r\n  }\r\n\r\n  /**\r\n   * Get events count\r\n   */\r\n  getCount() {\r\n    return this.events.length;\r\n  }\r\n\r\n  /**\r\n   * Get storage statistics\r\n   */\r\n  getStatistics() {\r\n    const eventsByType = {};\r\n    const eventsBySeverity = {};\r\n    const eventsBy日 = {};\r\n\r\n    this.events.forEach((event) => {\r\n      // Count by type\r\n      eventsByType[event.eventType] = (eventsByType[event.eventType] || 0) + 1;\r\n\r\n      // Count by severity\r\n      eventsBySeverity[event.severity] = (eventsBySeverity[event.severity] || 0) + 1;\r\n\r\n      // Count by day\r\n      const day = event.timestamp.split('T')[0];\r\n      eventsBy日[day] = (eventsBy日[day] || 0) + 1;\r\n    });\r\n\r\n    return {\r\n      totalEvents: this.events.length,\r\n      eventsByType,\r\n      eventsBySeverity,\r\n      eventsByDay: eventsBy日,\r\n      oldestEvent: this.events.length > 0 ? this.events[0].timestamp : null,\r\n      newestEvent: this.events.length > 0 ? this.events[this.events.length - 1].timestamp : null,\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Clinical Audit Trail System\r\n */\r\nexport class ClinicalAuditTrail {\r\n  constructor() {\r\n    this.storage = new AuditStorage();\r\n    this.isActive = false;\r\n    this.currentSession = null;\r\n    this.automaticEvents = new Set([\r\n      MEDICAL_EVENTS.PREDICTION_GENERATED,\r\n      MEDICAL_EVENTS.CLINICAL_ALERT,\r\n      MEDICAL_EVENTS.FORM_UPDATED,\r\n      MEDICAL_EVENTS.AUDIT_EVENT,\r\n    ]);\r\n  }\r\n\r\n  /**\r\n   * Initialize audit trail system\r\n   */\r\n  async initialize() {\r\n    const metricId = medicalPerformanceMonitor.startMeasurement(\r\n      PerformanceMetricType.SYSTEM_STARTUP,\r\n      'audit_trail_init',\r\n    );\r\n\r\n    try {\r\n      // Setup event listeners for automatic auditing\r\n      this.setupEventListeners();\r\n\r\n      // Start session tracking\r\n      this.startSession();\r\n\r\n      this.isActive = true;\r\n\r\n      medicalPerformanceMonitor.endMeasurement(metricId, { success: true });\r\n\r\n      this.logEvent(AuditEventTypes.CONFIGURATION_CHANGE, {\r\n        action: 'audit_trail_initialized',\r\n        resource: 'audit_system',\r\n        metadata: {\r\n          version: '1.0',\r\n          riskClass: 'B',\r\n          safetyRequirement: 'Clinical decision audit logging',\r\n        },\r\n      });\r\n\r\n      // ('📋 Clinical audit trail system initialized');\r\n    } catch (error) {\r\n      medicalPerformanceMonitor.endMeasurement(metricId, {\r\n        success: false,\r\n        error: error.message,\r\n      });\r\n\r\n      // ('Audit trail initialization failed:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup event listeners for automatic audit logging\r\n   */\r\n  setupEventListeners() {\r\n    // Listen for medical events\r\n    this.automaticEvents.forEach((eventType) => {\r\n      medicalEventObserver.subscribe(eventType, (data) => {\r\n        this.handleAutomaticEvent(eventType, data);\r\n      });\r\n    });\r\n\r\n    // Listen for form submissions\r\n    document.addEventListener('submit', (event) => {\r\n      this.handleFormSubmission(event);\r\n    });\r\n\r\n    // Listen for page navigation\r\n    window.addEventListener('beforeunload', () => {\r\n      this.logEvent(AuditEventTypes.USER_LOGOUT, {\r\n        action: 'session_ended',\r\n        resource: 'application',\r\n      });\r\n    });\r\n\r\n    // Listen for errors\r\n    window.addEventListener('error', (event) => {\r\n      this.logEvent(AuditEventTypes.SYSTEM_ERROR, {\r\n        severity: AuditSeverity.ERROR,\r\n        action: 'javascript_error',\r\n        resource: event.filename || 'unknown',\r\n        errorMessage: event.message,\r\n        metadata: {\r\n          line: event.lineno,\r\n          column: event.colno,\r\n          stack: event.error?.stack,\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Start user session\r\n   */\r\n  startSession() {\r\n    this.currentSession = {\r\n      id: `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n      startTime: new Date().toISOString(),\r\n      userId: 'clinical_user', // In real implementation, get from auth\r\n      events: [],\r\n    };\r\n\r\n    this.logEvent(AuditEventTypes.USER_LOGIN, {\r\n      action: 'session_started',\r\n      resource: 'application',\r\n      sessionId: this.currentSession.id,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Log audit event\r\n   */\r\n  logEvent(eventType, data = {}) {\r\n    if (!this.isActive) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Add session information\r\n      if (this.currentSession) {\r\n        data.sessionId = this.currentSession.id;\r\n        data.userId = data.userId || this.currentSession.userId;\r\n      }\r\n\r\n      // Create audit event\r\n      const event = new AuditEvent(eventType, data);\r\n\r\n      // Store event\r\n      this.storage.store(event);\r\n\r\n      // Add to current session\r\n      if (this.currentSession) {\r\n        this.currentSession.events.push(event.id);\r\n      }\r\n\r\n      // Notify for critical events\r\n      if (event.severity === AuditSeverity.CRITICAL || event.severity === AuditSeverity.ERROR) {\r\n        this.notifyCriticalEvent(event);\r\n      }\r\n\r\n      return event.id;\r\n    } catch (error) {\r\n      // ('Failed to log audit event:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle automatic events\r\n   */\r\n  handleAutomaticEvent(eventType, data) {\r\n    switch (eventType) {\r\n      case MEDICAL_EVENTS.PREDICTION_GENERATED:\r\n        this.logEvent(AuditEventTypes.PREDICTION_GENERATED, {\r\n          action: 'prediction_generated',\r\n          resource: 'predictive_engine',\r\n          patientId: data.patientId,\r\n          metadata: {\r\n            predictions: Object.keys(data.predictions || {}),\r\n            confidence: data.predictions?.mortality?.confidence?.level,\r\n          },\r\n        });\r\n        break;\r\n\r\n      case MEDICAL_EVENTS.CLINICAL_ALERT:\r\n        this.logEvent(AuditEventTypes.ALERT_TRIGGERED, {\r\n          severity: data.alert?.severity?.level === 'critical' ? AuditSeverity.CRITICAL : AuditSeverity.WARNING,\r\n          action: data.action === 'activated' ? 'alert_triggered' : 'alert_acknowledged',\r\n          resource: 'clinical_decision_support',\r\n          patientId: data.alert?.patientId,\r\n          metadata: {\r\n            alertId: data.alert?.id,\r\n            alertType: data.alert?.ruleId,\r\n            alertTitle: data.alert?.title,\r\n          },\r\n        });\r\n        break;\r\n\r\n      case MEDICAL_EVENTS.FORM_UPDATED:\r\n        this.logEvent(AuditEventTypes.DATA_ENTRY, {\r\n          action: 'form_data_updated',\r\n          resource: `form_${data.module}`,\r\n          patientId: data.patientId,\r\n          metadata: {\r\n            module: data.module,\r\n            fieldsUpdated: Object.keys(data.formData || {}),\r\n          },\r\n        });\r\n        break;\r\n\r\n      case MEDICAL_EVENTS.AUDIT_EVENT:\r\n        // Don't log audit events to avoid recursion\r\n        break;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle form submissions\r\n   */\r\n  handleFormSubmission(event) {\r\n    const form = event.target;\r\n    if (form.dataset.module) {\r\n      const formData = new FormData(form);\r\n      const patientData = Object.fromEntries(formData.entries());\r\n\r\n      this.logEvent(AuditEventTypes.CLINICAL_DECISION, {\r\n        action: 'clinical_assessment_submitted',\r\n        resource: `module_${form.dataset.module}`,\r\n        metadata: {\r\n          module: form.dataset.module,\r\n          fieldsSubmitted: Object.keys(patientData),\r\n          timestamp: new Date().toISOString(),\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log data modification\r\n   */\r\n  logDataModification(resource, oldValue, newValue, options = {}) {\r\n    return this.logEvent(AuditEventTypes.DATA_MODIFICATION, {\r\n      action: 'data_modified',\r\n      resource,\r\n      oldValue,\r\n      newValue,\r\n      patientId: options.patientId,\r\n      metadata: {\r\n        reason: options.reason || 'Clinical update',\r\n        signature: options.signature,\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Log report generation\r\n   */\r\n  logReportGeneration(reportType, patientId, options = {}) {\r\n    return this.logEvent(AuditEventTypes.REPORT_GENERATED, {\r\n      action: 'clinical_report_generated',\r\n      resource: `report_${reportType}`,\r\n      patientId,\r\n      metadata: {\r\n        reportType,\r\n        format: options.format || 'html',\r\n        recipient: options.recipient,\r\n        reason: options.reason || 'Clinical documentation',\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Log data export\r\n   */\r\n  logDataExport(dataType, format, options = {}) {\r\n    return this.logEvent(AuditEventTypes.DATA_EXPORT, {\r\n      severity: AuditSeverity.WARNING,\r\n      action: 'data_exported',\r\n      resource: `export_${dataType}`,\r\n      metadata: {\r\n        dataType,\r\n        format,\r\n        recordCount: options.recordCount,\r\n        recipient: options.recipient,\r\n        purpose: options.purpose || 'Clinical analysis',\r\n      },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Search audit events\r\n   */\r\n  searchEvents(criteria) {\r\n    return this.storage.search(criteria);\r\n  }\r\n\r\n  /**\r\n   * Get audit trail for patient\r\n   */\r\n  getPatientAuditTrail(patientId, options = {}) {\r\n    const criteria = {\r\n      patientId,\r\n      startDate: options.startDate,\r\n      endDate: options.endDate,\r\n    };\r\n\r\n    return this.storage.search(criteria);\r\n  }\r\n\r\n  /**\r\n   * Get audit trail for user\r\n   */\r\n  getUserAuditTrail(userId, options = {}) {\r\n    const criteria = {\r\n      userId,\r\n      startDate: options.startDate,\r\n      endDate: options.endDate,\r\n    };\r\n\r\n    return this.storage.search(criteria);\r\n  }\r\n\r\n  /**\r\n   * Generate compliance report\r\n   */\r\n  generateComplianceReport(framework, options = {}) {\r\n    const events = this.storage.search({\r\n      startDate: options.startDate,\r\n      endDate: options.endDate,\r\n    });\r\n\r\n    const complianceEvents = events.filter((event) => event.compliance.includes(framework));\r\n\r\n    const report = {\r\n      framework,\r\n      reportPeriod: {\r\n        start: options.startDate || 'N/A',\r\n        end: options.endDate || 'N/A',\r\n      },\r\n      totalEvents: complianceEvents.length,\r\n      events: complianceEvents.map((event) => event.exportForCompliance(framework)),\r\n      summary: this.generateComplianceSummary(complianceEvents, framework),\r\n      generatedAt: new Date().toISOString(),\r\n    };\r\n\r\n    // Log report generation\r\n    this.logEvent(AuditEventTypes.REPORT_GENERATED, {\r\n      action: 'compliance_report_generated',\r\n      resource: `compliance_${framework}`,\r\n      metadata: {\r\n        framework,\r\n        eventCount: complianceEvents.length,\r\n        period: report.reportPeriod,\r\n      },\r\n    });\r\n\r\n    return report;\r\n  }\r\n\r\n  /**\r\n   * Generate compliance summary\r\n   */\r\n  generateComplianceSummary(events, framework) {\r\n    const summary = {\r\n      totalEvents: events.length,\r\n      eventsByType: {},\r\n      eventsBySeverity: {},\r\n      complianceMetrics: {},\r\n    };\r\n\r\n    events.forEach((event) => {\r\n      // Count by type\r\n      summary.eventsByType[event.eventType] = (summary.eventsByType[event.eventType] || 0) + 1;\r\n\r\n      // Count by severity\r\n      summary.eventsBySeverity[event.severity] = (summary.eventsBySeverity[event.severity] || 0) + 1;\r\n    });\r\n\r\n    // Framework-specific metrics\r\n    switch (framework) {\r\n      case ComplianceFrameworks.HIPAA:\r\n        summary.complianceMetrics = {\r\n          patientAccesses: summary.eventsByType[AuditEventTypes.PATIENT_ACCESS] || 0,\r\n          dataExports: summary.eventsByType[AuditEventTypes.DATA_EXPORT] || 0,\r\n          unauthorizedAttempts: events.filter((e) => e.outcome === 'failure').length,\r\n        };\r\n        break;\r\n\r\n      case ComplianceFrameworks.FDA_21CFR11:\r\n        summary.complianceMetrics = {\r\n          electronicRecords: summary.eventsByType[AuditEventTypes.DATA_ENTRY] || 0,\r\n          recordModifications: summary.eventsByType[AuditEventTypes.DATA_MODIFICATION] || 0,\r\n          signedRecords: events.filter((e) => e.metadata?.signature).length,\r\n        };\r\n        break;\r\n\r\n      case ComplianceFrameworks.IEC_62304:\r\n        summary.complianceMetrics = {\r\n          softwareEvents: summary.eventsByType[AuditEventTypes.MODEL_PREDICTION] || 0,\r\n          systemErrors: summary.eventsByType[AuditEventTypes.SYSTEM_ERROR] || 0,\r\n          configurationChanges: summary.eventsByType[AuditEventTypes.CONFIGURATION_CHANGE] || 0,\r\n        };\r\n        break;\r\n    }\r\n\r\n    return summary;\r\n  }\r\n\r\n  /**\r\n   * Verify audit trail integrity\r\n   */\r\n  verifyIntegrity() {\r\n    const results = {\r\n      totalEvents: this.storage.getCount(),\r\n      verified: 0,\r\n      failed: 0,\r\n      issues: [],\r\n    };\r\n\r\n    this.storage.events.forEach((event) => {\r\n      const expectedHash = event.calculateHash();\r\n      if (event.hash === expectedHash) {\r\n        results.verified++;\r\n      } else {\r\n        results.failed++;\r\n        results.issues.push({\r\n          eventId: event.id,\r\n          timestamp: event.timestamp,\r\n          issue: 'Hash mismatch - possible tampering',\r\n        });\r\n      }\r\n    });\r\n\r\n    // Log integrity check\r\n    this.logEvent(AuditEventTypes.CONFIGURATION_CHANGE, {\r\n      action: 'integrity_verification',\r\n      resource: 'audit_trail',\r\n      outcome: results.failed === 0 ? 'success' : 'warning',\r\n      metadata: {\r\n        verified: results.verified,\r\n        failed: results.failed,\r\n        totalChecked: results.totalEvents,\r\n      },\r\n    });\r\n\r\n    return results;\r\n  }\r\n\r\n  /**\r\n   * Export audit trail\r\n   */\r\n  exportAuditTrail(format = 'json', options = {}) {\r\n    const events = this.storage.search({\r\n      startDate: options.startDate,\r\n      endDate: options.endDate,\r\n      eventType: options.eventType,\r\n      userId: options.userId,\r\n      patientId: options.patientId,\r\n    });\r\n\r\n    const exportData = {\r\n      metadata: {\r\n        exportedAt: new Date().toISOString(),\r\n        totalEvents: events.length,\r\n        period: {\r\n          start: options.startDate || 'beginning',\r\n          end: options.endDate || 'now',\r\n        },\r\n        filters: options,\r\n      },\r\n      events: events.map((event) => event.sanitize()),\r\n    };\r\n\r\n    // Log export\r\n    this.logDataExport('audit_trail', format, {\r\n      recordCount: events.length,\r\n      purpose: options.purpose || 'Compliance audit',\r\n    });\r\n\r\n    switch (format) {\r\n      case 'json':\r\n        return JSON.stringify(exportData, null, 2);\r\n\r\n      case 'csv':\r\n        return this.convertToCSV(exportData.events);\r\n\r\n      case 'xml':\r\n        return this.convertToXML(exportData);\r\n\r\n      default:\r\n        return exportData;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Convert events to CSV format\r\n   */\r\n  convertToCSV(events) {\r\n    if (events.length === 0) {\r\n      return '';\r\n    }\r\n\r\n    const headers = ['Timestamp', 'Event Type', 'User ID', 'Action', 'Resource', 'Outcome', 'Severity'];\r\n    const rows = [headers];\r\n\r\n    events.forEach((event) => {\r\n      rows.push([\r\n        event.timestamp,\r\n        event.eventType,\r\n        event.userId,\r\n        event.action || '',\r\n        event.resource || '',\r\n        event.outcome,\r\n        event.severity,\r\n      ]);\r\n    });\r\n\r\n    return rows.map((row) => row.map((cell) => `\"${cell}\"`).join(',')).join('\\n');\r\n  }\r\n\r\n  /**\r\n   * Convert events to XML format\r\n   */\r\n  convertToXML(exportData) {\r\n    let xml = '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\\n';\r\n    xml += '<auditTrail>\\n';\r\n    xml += '  <metadata>\\n';\r\n    xml += `    <exportedAt>${exportData.metadata.exportedAt}</exportedAt>\\n`;\r\n    xml += `    <totalEvents>${exportData.metadata.totalEvents}</totalEvents>\\n`;\r\n    xml += '  </metadata>\\n';\r\n    xml += '  <events>\\n';\r\n\r\n    exportData.events.forEach((event) => {\r\n      xml += '    <event>\\n';\r\n      xml += `      <id>${event.id}</id>\\n`;\r\n      xml += `      <timestamp>${event.timestamp}</timestamp>\\n`;\r\n      xml += `      <eventType>${event.eventType}</eventType>\\n`;\r\n      xml += `      <userId>${event.userId}</userId>\\n`;\r\n      xml += `      <action>${event.action || ''}</action>\\n`;\r\n      xml += `      <resource>${event.resource || ''}</resource>\\n`;\r\n      xml += `      <outcome>${event.outcome}</outcome>\\n`;\r\n      xml += `      <severity>${event.severity}</severity>\\n`;\r\n      xml += '    </event>\\n';\r\n    });\r\n\r\n    xml += '  </events>\\n';\r\n    xml += '</auditTrail>';\r\n\r\n    return xml;\r\n  }\r\n\r\n  /**\r\n   * Notify critical event\r\n   */\r\n  notifyCriticalEvent(event) {\r\n    // (`🚨 Critical audit event: ${event.eventType} - ${event.action}`);\r\n\r\n    // In real implementation, this would trigger alerts to administrators\r\n    medicalEventObserver.publish(MEDICAL_EVENTS.CLINICAL_ALERT, {\r\n      alert: {\r\n        id: `audit_${event.id}`,\r\n        severity: { level: 'critical', icon: '🚨' },\r\n        title: 'Critical Audit Event',\r\n        message: `${event.eventType}: ${event.action}`,\r\n        recommendation: 'Review audit event immediately',\r\n      },\r\n      action: 'activated',\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Get audit statistics\r\n   */\r\n  getStatistics() {\r\n    return this.storage.getStatistics();\r\n  }\r\n\r\n  /**\r\n   * Get current session information\r\n   */\r\n  getCurrentSession() {\r\n    return this.currentSession;\r\n  }\r\n\r\n  /**\r\n   * Stop audit trail system\r\n   */\r\n  stop() {\r\n    if (this.currentSession) {\r\n      this.logEvent(AuditEventTypes.USER_LOGOUT, {\r\n        action: 'audit_system_stopped',\r\n        resource: 'audit_system',\r\n      });\r\n    }\r\n\r\n    this.isActive = false;\r\n    // ('📋 Clinical audit trail system stopped');\r\n  }\r\n\r\n  /**\r\n   * Dispose audit trail system\r\n   */\r\n  dispose() {\r\n    this.stop();\r\n    this.storage.events.length = 0;\r\n    this.storage.indices.clear();\r\n    this.currentSession = null;\r\n\r\n    // ('📋 Clinical audit trail system disposed');\r\n  }\r\n}\r\n\r\n// Export audit trail instance\r\nexport const clinicalAuditTrail = new ClinicalAuditTrail();\r\n"],"names":["LegacyICHModel","age","gfapValue","scaledAge","scaledGfap","logit","rawProbability","probability","confidence","riskCategory","error","mainResults","legacyResults","mainProb","legacyProb","absoluteDifference","relativeDifference","higherRiskModel","agreement","absDiff","difference","results","testCase","result","passedTests","totalTests","__publicField","calculateLegacyICH","patientData","gfap","ResearchDataLogger","comparisonData","entry","stored","data","headers","rows","_a","_b","_c","_d","_e","_f","_h","_g","_j","_i","_l","_k","_n","_m","format","filename","blob","url","link","entries","differences","e","d","avgDifference","sum","sessionId","safeLogResearchData","inputs","isResearchModeEnabled","module","store","formData","renderResearchToggle","renderModelComparison","comparison","renderProbabilityBars","renderDifferenceAnalysis","renderCalculationDetails","renderModelMetrics","metadata","initializeResearchMode","closeResearch","panel","exportButton","detailsToggle","details","clearButton","ReportTypes","ReportFormats","DeliveryMethods","ClinicalReportGenerator","reportType","options","metricId","medicalPerformanceMonitor","PerformanceMetricType","template","reportContent","formattedReport","reportMetadata","medicalEventObserver","MEDICAL_EVENTS","missingData","requirement","sections","dataQuality","sectionName","section","demographics","presentation","predictions","findings","risks","risk","level","score","recommendations","recs","rec","disposition","overview","mortalityData","content","factor","functionalData","summary","requiredFields","availableFields","field","missingFields","l","html","alerts","alert","hemorrhagicData","mlResults","complicationsData","comp","ClinicalReportingSystem","schedule","scheduleId","report","deliveryMethod","deliveryOptions","deliveryItem","frequency","now","filters","history","array","key","item","group","totalQuality","last30Days","clinicalReportingSystem","QualityCategories","ClinicalIndicators","QualityBenchmarks","QualityMetric","indicator","category","value","timestamp","excellent","good","acceptable","isLowerBetter","QualityAggregator","metric","agg","timeKey","metricTrends","dayTrend","val","v","days","trends","i","date","values","sorted","a","b","mid","mean","avgSquaredDiff","QualityDashboard","aggregator","indicators","dashboard","stats","indicatorData","allMetrics","last24Hours","m","performanceScores","avgPerformance","validTrends","t","recent","previous","change","direction","performance","trend","summaries","points","regression","significance","n","sumX","sumY","sumXY","sumXX","sumYY","slope","intercept","numerator","denominator","correlation","QualityMetricsTracker","collectionPromises","collector","successful","detailed","isAppropriate","doorToNeedleTime","row","trendDirection","indicatorSummary","qualityMetricsTracker","AuditEventTypes","AuditSeverity","ComplianceFrameworks","AuditEvent","eventType","requirements","dataString","hash","char","sanitized","obj","framework","baseExport","AuditStorage","event","eventTypeIndex","userIndex","patientIndex","dateKey","dateIndex","eventsToRemove","cutoffTime","shouldKeep","eventIds","index","sanitizedEvent","predictionCache","criteria","candidateIds","firstCriteria","ids","id","events","filtered","startDate","endDate","searchTerm","eventsByType","eventsBySeverity","eventsBy日","day","ClinicalAuditTrail","form","resource","oldValue","newValue","patientId","dataType","userId","complianceEvents","expectedHash","exportData","cell","xml","clinicalAuditTrail"],"mappings":"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"}